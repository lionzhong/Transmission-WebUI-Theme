function setInnerHTML(e,t){e&&e.currentHTML!=t&&(e.currentHTML=t,e.innerHTML=t)}function sanitizeText(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function setTextContent(e,t){e&&e.textContent!=t&&(e.textContent=t)}function Prefs(){}function parseUri(e){for(var t=parseUri.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(e,r,i){r&&(n[t.q.name][r]=i)}),n}function Inspector(e){var t={controller:null,elements:{},torrents:[]},r=function(e){var t,r;for(t=0;r=e[t];t++)if(!r.hasExtraInfo())return!0;return!1},n=function(){var e,n=$.map(t.torrents.slice(0),function(e){return e.getId()});n&&n.length&&(e=["id"].concat(Torrent.Fields.StatsExtra),r(t.torrents)&&$.merge(e,Torrent.Fields.InfoExtra),t.controller.updateTorrents(n,e))},i=function(e){var t=e.currentTarget;isMobileDevice&&e.stopPropagation(),$(t).addClass("selected").siblings().removeClass("selected"),$("#"+t.id.replace("tab","page")).show().siblings(".inspector-page").hide(),o()},o=function(){var e,r=t.elements,n=t.torrents;e=n&&n.length?1===n.length?n[0].getName():""+n.length+" Transfers Selected":"No Selection",setTextContent(r.name_lb,e||na),$(r.info_page).is(":visible")?s():$(r.peers_page).is(":visible")?g():$(r.trackers_page).is(":visible")?S():$(r.files_page).is(":visible")&&m()},s=function(){var e,r,n,i,o,s,a,l,d,c,u,h,f,p,m,g,_,T,v,S,b,w,C=t.torrents,y=t.elements,k=Transmission.fmt,$="none",D="已混合",P="未知",R=0,x=0,M=0,F=0,E=0,A=0,B=Date.now();if(C.length<1)i=$;else{for(e=!1,r=!0,n=!0,o=C[0].getStatus(),a=0;l=C[a];++a)s=l.getStatus(),s!=o&&(e=!0),l.isStopped()||(r=n=!1),l.isFinished()||(n=!1);i=e?D:n?"已结束":r?"已暂停":C[0].getStateString()}if(setTextContent(y.state_lb,i),d=i,C.length<1)i=$;else{for(o=C[0].getStatus(),a=0;l=C[a];++a)l.needsMetaData()||(E+=l.getHaveUnchecked(),T=l.getHaveValid(),F+=T,l.getPieceSize()&&(A+=T/l.getPieceSize()),R+=l.getSizeWhenDone(),x+=l.getLeftUntilDone(),M+=l.getHave()+l.getDesiredAvailable());b=100*(R?(R-x)/R:1),i=k.percentString(b),i=E||x?E?k.size(F)+" / "+k.size(R)+" ("+i+"%), "+k.size(E)+" 未验证":k.size(F)+" / "+k.size(R)+" ("+i+"%)":k.size(F)+" (100%)"}if(setTextContent(y.have_lb,i),i=C.length<1?$:0==R?$:""+k.percentString(100*M/R)+"%",setTextContent(y.availability_lb,i),C.length<1)i=$;else{for(b=S=0,a=0;l=C[a];++a)b+=l.getDownloadedEver(),S+=l.getFailedEver();i=S?k.size(b)+" ("+k.size(S)+" 损坏)":k.size(b)}if(setTextContent(y.downloaded_lb,i),C.length<1)i=$;else{if(b=v=0,1==C.length)b=C[0].getDownloadedEver(),v=C[0].getUploadedEver(),0==b&&(b=C[0].getHaveValid());else for(a=0;l=C[a];++a)b+=l.getDownloadedEver(),v+=l.getUploadedEver();i=k.size(v)+" (分享率: "+k.ratioString(Math.ratio(v,b))+")"}if(setTextContent(y.uploaded_lb,i),C.length<1)i=$;else{for(r=!0,o=C[0].getStartDate(),a=0;l=C[a];++a)o!=l.getStartDate()&&(o=0),l.isStopped()||(r=!1);i=r?d:o?k.timeInterval(B/1e3-o):D}if(setTextContent(y.running_time_lb,i),i="",C.length<1)i=$;else for(o=C[0].getETA(),a=0;l=C[a];++a)if(o!=l.getETA()){i=D;break}if(i.length||(i=o<0?P:k.timeInterval(o)),setTextContent(y.remaining_time_lb,i),c=-1,C.length<1)i=$;else{for(o=C[0].getLastActivity(),a=0;l=C[a];++a)b=l.getLastActivity(),c<b&&(c=b);b=B/1e3-c,i=b<0?$:b<5?"处于活跃中":k.timeInterval(b)+" 之前"}if(setTextContent(y.last_activity_lb,i),C.length<1)i=$;else for(i=C[0].getErrorString(),a=0;l=C[a];++a)if(i!=l.getErrorString()){i=D;break}if(setTextContent(y.error_lb,i||$),C.length<1)i=$;else{for(u=0,h=0,f=C[0].getPieceSize(),a=0;l=C[a];++a)u+=l.getPieceCount(),h+=l.getTotalSize(),f!=l.getPieceSize()&&(f=0);i=h?f>0?k.size(h)+" ("+u.toStringWithCommas()+" pieces @ "+k.mem(f)+")":k.size(h)+" ("+u.toStringWithCommas()+" pieces)":$}if(setTextContent(y.size_lb,i),C.length<1)i=$;else for(i=C[0].getHashString(),a=0;l=C[a];++a)if(i!=l.getHashString()){i=D;break}if(setTextContent(y.hash_lb,i),C.length<1)i=$;else for(o=C[0].getPrivateFlag(),i=o?"私有种子 -- DHT 和 PEX 已禁用":"公开的种子",a=0;l=C[a];++a)if(o!=l.getPrivateFlag()){i=D;break}if(setTextContent(y.privacy_lb,i),C.length<1)i=$;else for(i=C[0].getComment(),a=0;l=C[a];++a)if(i!=l.getComment()){i=D;break}i||(i=$),w=parseUri(i),"http"==w.protocol||"https"==w.parseUri?(i=encodeURI(i),setInnerHTML(y.comment_lb,'<a href="'+i+'" target="_blank" >'+i+"</a>")):setTextContent(y.comment_lb,i);var I=function(e,t,r){var n="";return 0===e&&0===t&&0===r?n="":(n+=e<10?"0"+e:e,n+=t<10?"-0"+t:"-"+t,void 0!==r&&(n+=r<10?"-0"+r:"-"+r)),n},U=function(e,t,r){var n="";return 0===e&&0===t&&0===r?n="":(n+=e<10?"0"+e:e,n+=t<10?":0"+t:":"+t,void 0!==r&&(n+=r<10?":0"+r:":"+r)),n},N=function(e,t){var r=new Date(e),n=I(r.getFullYear(),r.getMonth()+1,r.getDate()),i=U(r.getHours(),r.getMinutes(),r.getSeconds());return t!==!0?n+" "+i:n};if(C.length<1)i=$;else{for(m=!1,_=!1,p=C[0].getCreator(),g=C[0].getDateCreated(),a=0;l=C[a];++a)p!=l.getCreator()&&(m=!0),g!=l.getDateCreated()&&(_=!0);var L=!p||!p.length,z=!g;i=m||_?D:L&&z?P:z&&!L?"创建自 "+p:L&&!z?"时间: "+N(1e3*g):"创建自 "+p+" 时间: "+N(1e3*g)}if(setTextContent(y.origin_lb,i),C.length<1)i=$;else for(i=C[0].getDownloadDir(),a=0;l=C[a];++a)if(i!=l.getDownloadDir()){i=D;break}setTextContent(y.foldername_lb,i)},a=function(e,r){var n=t.file_torrent.getId();t.controller.changeFileCommand(n,e,r)},l=function(e,t,r){a(t,r?"files-wanted":"files-unwanted")},d=function(e,t,r){var n;switch(r){case-1:n="priority-low";break;case 1:n="priority-high";break;default:n="priority-normal"}a(t,n)},c=function(e,t,r){$(t.getElement()).siblings().slideToggle()},u=function(){$(t.elements.file_list).empty(),delete t.file_torrent,delete t.file_torrent_n,delete t.file_rows},h=function(e){var t,r,n,i,o,s,a,l,d,c=[],a={children:{},file_indices:[]};for(n=e.getFileCount(),t=0;t<n;++t){for(i=e.getFile(t).name,o=i.split("/"),s=a,r=0;r<o.length;++r)l=o[r],d=s.children[l],d||(s.children[l]=d={name:l,parent:s,children:{},file_indices:[],depth:r}),s=d;s.file_index=t,delete s.children,c.push(s)}for(t=0;t<c.length;++t){s=c[t],r=s.file_index;do s.file_indices.push(r),s=s.parent;while(s)}return a},f=function(e,r,n,i){var o;o=new FileRow(e,n.depth,n.name,n.file_indices,i%2),t.file_rows.push(o),r.appendChild(o.getElement()),$(o).bind("wantedToggled",l),$(o).bind("priorityToggled",d),$(o).bind("nameClicked",c)},p=function(e,t,r,n){var i,o;if(o=document.createElement("div"),r.parent&&f(e,o,r,n++),r.children)for(i in r.children)n=p(e,o,r.children[i]);return t.appendChild(o),n},m=function(){var e,r,n,i,o,s=t.elements.file_list,a=t.torrents;if(1!==a.length)return void u();if(n=a[0],r=n?n.getFileCount():0,n!=t.file_torrent||r!=t.file_torrent_n)u(),t.file_torrent=n,t.file_torrent_n=r,t.file_rows=[],i=document.createDocumentFragment(),o=h(n),p(n,i,o,0),s.appendChild(i);else for(e=0,r=t.file_rows.length;e<r;++e)t.file_rows[e].refresh()},g=function(){var e,r,n,i,o,s,a=[],l=Transmission.fmt,d=t.elements.peers_list,c=t.torrents;for(r=0;n=c[r];++r)if(i=n.getPeers(),a.push('<div class="inspector_group">'),c.length>1&&a.push('<div class="inspector_torrent_label">',sanitizeText(n.getName()),"</div>"),i&&i.length){for(a.push('<table class="peer_list">','<tr class="inspector_peer_entry even">','<th class="encryptedCol"></th>','<th class="upCol">Up</th>','<th class="downCol">Down</th>','<th class="percentCol">%</th>','<th class="statusCol">Status</th>','<th class="addressCol">Address</th>','<th class="clientCol">Client</th>',"</tr>"),e=0;o=i[e];++e)s=e%2?"odd":"even",a.push('<tr class="inspector_peer_entry ',s,'">',"<td>",o.isEncrypted?'<div class="encrypted-peer-cell" title="Encrypted Connection">':'<div class="unencrypted-peer-cell">',"</div>","</td>","<td>",o.rateToPeer?l.speedBps(o.rateToPeer):"","</td>","<td>",o.rateToClient?l.speedBps(o.rateToClient):"","</td>",'<td class="percentCol">',Math.floor(100*o.progress),"%","</td>","<td>",l.peerStatus(o.flagStr),"</td>","<td>",sanitizeText(o.address),"</td>",'<td class="clientCol">',sanitizeText(o.clientName),"</td>","</tr>");a.push("</table></div>")}else a.push("<br></div>");setInnerHTML(d,a.join(""))},_=function(e){var t,r="";switch(e.announceState){case Torrent._TrackerActive:r="发布正在进行中";break;case Torrent._TrackerWaiting:t=e.nextAnnounceTime-(new Date).getTime()/1e3,t<0&&(t=0),r="下一次发布: "+Transmission.fmt.timeInterval(t);break;case Torrent._TrackerQueued:r="发布已排队";break;case Torrent._TrackerInactive:r=e.isBackup?"Tracker 将会被用作备份":"发布未被计划";break;default:r="未知发布状态: "+e.announceState}return r},T=function(e){var t,r="最后一次发布",n=["N/A"];return e.hasAnnounced&&(t=Transmission.fmt.timestamp(e.lastAnnounceTime),e.lastAnnounceSucceeded?n=[t," (got ",Transmission.fmt.countString("peer","peers",e.lastAnnouncePeerCount),")"]:(r="发布错误",n=[e.lastAnnounceResult?e.lastAnnounceResult+" - ":"",t])),{label:r,value:n.join("")}},v=function(e){var t,r="最后一次削刮",n="N/A";return e.hasScraped&&(t=Transmission.fmt.timestamp(e.lastScrapeTime),e.lastScrapeSucceeded?n=t:(r="削刮错误",n=(e.lastScrapeResult?e.lastScrapeResult+" - ":"")+t)),{label:r,value:n}},S=function(){var e,r,n,i,o,s,a,l,d,c,u,h="N/A",f=t.elements.trackers_list,p=t.torrents;for(a=[],e=0;s=p[e];++e){for(a.push('<div class="inspector_group">'),p.length>1&&a.push('<div class="inspector_torrent_label">',s.getName(),"</div>"),n=-1,o=s.getTrackers(),r=0;i=o[r];++r)n!=i.tier&&(n!==-1&&a.push("</ul></div>"),n=i.tier,a.push('<div class="inspector_group_label">',"Tier ",n+1,"</div>",'<ul class="tier_list">')),d=T(i),c=_(i),u=v(i),l=r%2?"odd":"even",a.push('<li class="inspector_tracker_entry ',l,'"><div class="tracker_host" title="',sanitizeText(i.announce),'">',sanitizeText(i.host||i.announce),"</div>",'<div class="tracker_activity">',"<div>",d.label,": ",d.value,"</div>","<div>",c,"</div>","<div>",u.label,": ",u.value,"</div>",'</div><table class="tracker_stats">',"<tr><th>Seeders:</th><td>",i.seederCount>-1?i.seederCount:h,"</td></tr>","<tr><th>Leechers:</th><td>",i.leecherCount>-1?i.leecherCount:h,"</td></tr>","<tr><th>Downloads:</th><td>",i.downloadCount>-1?i.downloadCount:h,"</td></tr>","</table></li>");n!==-1&&a.push("</ul></div>"),a.push("</div>")}setInnerHTML(f,a.join(""))},b=function(e){t.controller=e,$(".inspector-tab").click(i),t.elements.info_page=$("#inspector-page-info")[0],t.elements.files_page=$("#inspector-page-files")[0],t.elements.peers_page=$("#inspector-page-peers")[0],t.elements.trackers_page=$("#inspector-page-trackers")[0],t.elements.file_list=$("#inspector_file_list")[0],t.elements.peers_list=$("#inspector_peers_list")[0],t.elements.trackers_list=$("#inspector_trackers_list")[0],t.elements.have_lb=$("#inspector-info-have")[0],t.elements.availability_lb=$("#inspector-info-availability")[0],t.elements.downloaded_lb=$("#inspector-info-downloaded")[0],t.elements.uploaded_lb=$("#inspector-info-uploaded")[0],t.elements.state_lb=$("#inspector-info-state")[0],t.elements.running_time_lb=$("#inspector-info-running-time")[0],t.elements.remaining_time_lb=$("#inspector-info-remaining-time")[0],t.elements.last_activity_lb=$("#inspector-info-last-activity")[0],t.elements.error_lb=$("#inspector-info-error")[0],t.elements.size_lb=$("#inspector-info-size")[0],t.elements.foldername_lb=$("#inspector-info-location")[0],t.elements.hash_lb=$("#inspector-info-hash")[0],t.elements.privacy_lb=$("#inspector-info-privacy")[0],t.elements.origin_lb=$("#inspector-info-origin")[0],t.elements.comment_lb=$("#inspector-info-comment")[0],t.elements.name_lb=$("#torrent_inspector_name")[0],o(),s(),g(),S(),m()};this.setTorrents=function(e){var r=t;$(r.torrents).unbind("dataChanged.inspector"),$(e).bind("dataChanged.inspector",$.proxy(o,this)),r.torrents=e,clearInterval(r.refreshInterval),r.refreshInterval=setInterval($.proxy(n,this),2e3),n(),o()},b(e)}function PrefsDialog(e){var t={dialog:null,remote:null,elements:{},keys:["alt-speed-down","alt-speed-time-begin","alt-speed-time-day","alt-speed-time-enabled","alt-speed-time-end","alt-speed-up","blocklist-enabled","blocklist-size","blocklist-url","dht-enabled","download-dir","encryption","idle-seeding-limit","idle-seeding-limit-enabled","lpd-enabled","peer-limit-global","peer-limit-per-torrent","peer-port","peer-port-random-on-start","pex-enabled","port-forwarding-enabled","rename-partial-files","seedRatioLimit","seedRatioLimited","speed-limit-down","speed-limit-down-enabled","speed-limit-up","speed-limit-up-enabled","start-added-torrents","utp-enabled"],groups:{"alt-speed-time-enabled":["alt-speed-time-begin","alt-speed-time-day","alt-speed-time-end"],"blocklist-enabled":["blocklist-url","blocklist-update-button"],"idle-seeding-limit-enabled":["idle-seeding-limit"],seedRatioLimited:["seedRatioLimit"],"speed-limit-down-enabled":["speed-limit-down"],"speed-limit-up-enabled":["speed-limit-up"]}},r=function(e){var t,r,n,i,o;for(t=0;t<96;++t)r=parseInt(t/4,10),n=t%4*15,i=15*t,o=r+":"+(n||"00"),e.options[t]=new Option(o,i)},n=function(e){var r=e.arguments["port-is-open"],n="Port is <b>"+(r?"Open":"Closed")+"</b>",i=t.elements.root.find("#port-label");setInnerHTML(i[0],n)},i=function(e,r){var n,i,o,s;if(e in t.groups)for(s=t.elements.root,o=t.groups[e],n=0;i=o[n];++n)s.find("#"+i).attr("disabled",!r)},o=function(){t.remote.updateBlocklist(),s(!1)},s=function(e){var r=t.elements.blocklist_button;r.attr("disabled",!e),r.val(e?"Update":"Updating...")},a=function(e){var t;switch(e[0].type){case"checkbox":case"radio":return e.prop("checked");case"text":case"url":case"email":case"number":case"search":case"select-one":return t=e.val(),parseInt(t,10).toString()===t?parseInt(t,10):parseFloat(t).toString()===t?parseFloat(t):t;default:return null}},l=function(e){var r={};r[e.target.id]=a($(e.target)),t.remote.savePrefs(r)},d=function(e){t.oldValue=a($(e.target))},c=function(e){var r=a($(e.target));if(r!==t.oldValue){var n={};n[e.target.id]=r,t.remote.savePrefs(n),delete t.oldValue}},u=function(){return{width:$(window).width(),height:$(window).height(),position:["left","top"]}},h=function(e){var n,i,s,a;for(t.remote=e,s=$("#prefs-dialog"),t.elements.root=s,r(s.find("#alt-speed-time-begin")[0]),r(s.find("#alt-speed-time-end")[0]),a=isMobileDevice?u():{width:350,height:400},a.autoOpen=!1,a.show=a.hide="fade",a.close=p,s.tabbedDialog(a),s=s.find("#blocklist-update-button"),t.elements.blocklist_button=s,s.click(o),n=0;i=t.keys[n];++n)switch(s=t.elements.root.find("#"+i),s[0].type){case"checkbox":case"radio":case"select-one":s.change(l);break;case"text":case"url":case"email":case"number":case"search":s.focus(d),s.blur(c)}},f=function(){var e,r,n,i={},o=t.keys,s=t.elements.root;for(e=0;r=o[e];++e)n=a(s.find("#"+r)),null!==n&&(i[r]=n);return i},p=function(){transmission.hideMobileAddressbar(),$(t.dialog).trigger("closed",f())};this.set=function(e){var r,n,o,a,l=t.keys,d=t.elements.root;for(s(!0),n=0;o=l[n];++n)if(a=e[o],r=d.find("#"+o),"blocklist-size"===o)r.text(""+a.toStringWithCommas());else switch(r[0].type){case"checkbox":case"radio":r.prop("checked",a),i(o,a);break;case"text":case"url":case"email":case"number":case"search":r[0]!==document.activeElement&&r.val(a);break;case"select-one":r.val(a)}},this.show=function(){transmission.hideMobileAddressbar(),s(!0),t.remote.checkPort(n,this),t.elements.root.dialog("open")},this.close=function(){transmission.hideMobileAddressbar(),t.elements.root.dialog("close")},this.shouldAddedTorrentsStart=function(){return t.elements.root.find("#start-added-torrents")[0].checked},t.dialog=this,h(e)}function TransmissionRemote(e){return this.initialize(e),this}function Transmission(){this.initialize()}function Torrent(e){this.initialize(e)}function TorrentRendererHelper(){}function TorrentRendererFull(){}function TorrentRendererCompact(){}function TorrentRow(e,t,r){this.initialize(e,t,r)}function FileRow(e,t,r,n,i){var o={have:0,indices:[],isWanted:!0,priorityLow:!1,priorityNormal:!1,priorityHigh:!1,me:this,size:0,torrent:null},s={priority_low_button:null,priority_normal_button:null,priority_high_button:null,progress:null,root:null},a=function(e,t,r,n,i){o.torrent=e,o.indices=n,f(e,t,r,i)},l=function(){var e=$(s.root);e.toggleClass("skip",!o.isWanted),e.toggleClass("complete",u()),$(e[0].checkbox).prop("disabled",!h()),$(e[0].checkbox).prop("checked",o.isWanted)},d=function(){var e=100*(o.size?o.have/o.size:1),t=[Transmission.fmt.size(o.have)," of ",Transmission.fmt.size(o.size)," (",Transmission.fmt.percentString(e),"%)"].join("");setTextContent(s.progress,t)},c=function(){var e,t,r=0,n=0,i=!1,a=!1,c=!1,u=!1;for(e=0;e<o.indices.length;++e)switch(t=o.torrent.getFile(o.indices[e]),r+=t.bytesCompleted,n+=t.length,i|=t.wanted,t.priority){case-1:a=!0;break;case 0:c=!0;break;case 1:u=!0}o.have==r&&o.size==n||(o.have=r,o.size=n,d()),o.isWanted!==i&&(o.isWanted=i,l()),o.priorityLow!==a&&(o.priorityLow=a,$(s.priority_low_button).toggleClass("selected",a)),o.priorityNormal!==c&&(o.priorityNormal=c,$(s.priority_normal_button).toggleClass("selected",c)),o.priorityHigh!==u&&(o.priorityHigh=u,$(s.priority_high_button).toggleClass("selected",u))},u=function(){return o.have>=o.size},h=function(){return o.torrent.getFileCount()>1&&!u()},f=function(e,t,r,n){var i,o,a;return o=document.createElement("li"),o.className="inspector_torrent_file_list_entry"+(n?"even":"odd"),s.root=o,i=document.createElement("input"),i.type="checkbox",i.className="file_wanted_control",i.title="Download file",$(i).change(function(e){p($(e.currentTarget).prop("checked"))}),o.checkbox=i,o.appendChild(i),i=document.createElement("div"),i.className="file-priority-radiobox",a=i,i=document.createElement("div"),i.className="low icon-keyboard_arrow_down",i.title="Low Priority",$(i).click(function(){m(-1)}),s.priority_low_button=i,a.appendChild(i),i=document.createElement("div"),i.className="normal icon-drag_handle",i.title="Normal Priority",$(i).click(function(){m(0)}),s.priority_normal_button=i,a.appendChild(i),i=document.createElement("div"),i.title="High Priority",i.className="high icon-keyboard_arrow_up",$(i).click(function(){m(1)}),s.priority_high_button=i,a.appendChild(i),o.appendChild(a),i=document.createElement("div"),i.className="inspector_torrent_file_list_entry_name",setTextContent(i,r),$(i).click(function(){g(-1)}),o.appendChild(i),i=document.createElement("div"),i.className="inspector_torrent_file_list_entry_progress",o.appendChild(i),$(i).click(function(){g(-1)}),s.progress=i,$(o).css("margin-left",""+16*t+"px"),c(),o},p=function(e){$(o.me).trigger("wantedToggled",[o.indices,e])},m=function(e){$(o.me).trigger("priorityToggled",[o.indices,e])},g=function(){$(o.me).trigger("nameClicked",[o.me,o.indices])};this.getElement=function(){return s.root},this.refresh=function(){c()},a(e,t,r,n,i)}function Dialog(){this.initialize()}var transmission,dialog,isMobileDevice=RegExp("(iPhone|iPod|Android)").test(navigator.userAgent),scroll_timeout;Array.indexOf||(Array.prototype.indexOf=function(e){var t,r;for(t=0,r=this.length;t<r;t++)if(this[t]==e)return t;return-1}),$.fn.tabbedDialog=function(e){this.tabs({selected:0}),this.dialog(e),this.find(".ui-tab-dialog-close").append(this.parent().find(".ui-dialog-titlebar-close")),this.find(".ui-tab-dialog-close").css({position:"absolute",right:"0",top:"16px"}),this.find(".ui-tab-dialog-close > a").css({float:"none",padding:"0"});var t=this.find("ul:first");this.parent().addClass("ui-tabs").prepend(t).draggable("option","handle",t),this.siblings(".ui-dialog-titlebar").remove(),t.addClass("ui-dialog-titlebar")},$(document).ready(function(){if(Date.now||(Date.now=function(){return+new Date}),$.browser.msie){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}$(".dialog_container").css("height",$(window).height()+"px")}$.browser.safari&&$("#torrent_search").css("margin-top",3),isMobileDevice?(window.onload=function(){setTimeout(function(){window.scrollTo(0,1)},500)},window.onorientationchange=function(){setTimeout(function(){window.scrollTo(0,1)},100)},window.navigator.standalone&&$("body div#torrent_container").css("min-height","338px"),$("label[for=torrent_upload_url]").text("URL: ")):$("div.dialog_container div.dialog_window").css("border","1px solid #777"),dialog=new Dialog,transmission=new Transmission}),Math.ratio=function(e,t){var r=Math.floor(100*e/t)/100;return r==Number.POSITIVE_INFINITY||r==Number.NEGATIVE_INFINITY?r=-2:isNaN(r)&&(r=-1),r},Number.prototype.toTruncFixed=function(e){var t=Math.floor(this*Math.pow(10,e))/Math.pow(10,e);return t.toFixed(e)},Number.prototype.toStringWithCommas=function(){return this.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")},String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")},Prefs.prototype={},Prefs._RefreshRate="refresh_rate",Prefs._FilterMode="filter",Prefs._FilterAll="all",Prefs._FilterActive="active",Prefs._FilterSeeding="seeding",Prefs._FilterDownloading="downloading",Prefs._FilterPaused="paused",Prefs._FilterFinished="finished",Prefs._SortDirection="sort_direction",Prefs._SortAscending="ascending",Prefs._SortDescending="descending",Prefs._SortMethod="sort_method",Prefs._SortByAge="age",Prefs._SortByActivity="activity",Prefs._SortByName="name",Prefs._SortByQueue="queue_order",Prefs._SortBySize="size",Prefs._SortByProgress="percent_completed",Prefs._SortByRatio="ratio",Prefs._SortByState="state",Prefs._CompactDisplayState="compact_display_state",Prefs._Defaults={filter:"all",refresh_rate:5,sort_direction:"ascending",sort_method:"name","turtle-state":!1,compact_display_state:!1},Prefs.setValue=function(e,t){e in Prefs._Defaults||console.warn("unrecognized preference key '%s'",e);var r=new Date;r.setFullYear(r.getFullYear()+1),document.cookie=e+"="+t+"; expires="+r.toGMTString()+"; path=/"},Prefs.getValue=function(e,t){var r;e in Prefs._Defaults||console.warn("unrecognized preference key '%s'",e);for(var n=document.cookie.split(";"),i=0,o=n.length;!r&&i<o;++i){var s=n[i].trim(),a=s.indexOf("=");a===e.length&&0===s.indexOf(e)&&(r=s.substring(a+1))}return r?"true"===r?r=!0:"false"===r&&(r=!1):r=t,r},Prefs.getClutchPrefs=function(e){e||(e={});for(var t in Prefs._Defaults)e[t]=Prefs.getValue(t,Prefs._Defaults[t]);return e},jQuery.fn.forceNumeric=function(){return this.each(function(){$(this).keydown(function(e){var t=e.which||e.keyCode;return!e.shiftKey&&!e.altKey&&!e.ctrlKey&&t>=48&&t<=57||t>=96&&t<=105||190===t||188===t||109===t||110===t||8===t||9===t||13===t||35===t||36===t||37===t||39===t||46===t||45===t})})},parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var RPC={_DaemonVersion:"version",_DownSpeedLimit:"speed-limit-down",_DownSpeedLimited:"speed-limit-down-enabled",_QueueMoveTop:"queue-move-top",_QueueMoveBottom:"queue-move-bottom",_QueueMoveUp:"queue-move-up",_QueueMoveDown:"queue-move-down",_Root:"../rpc",_TurtleDownSpeedLimit:"alt-speed-down",_TurtleState:"alt-speed-enabled",_TurtleUpSpeedLimit:"alt-speed-up",_UpSpeedLimit:"speed-limit-up",_UpSpeedLimited:"speed-limit-up-enabled"};TransmissionRemote.prototype={initialize:function(e){this._controller=e,this._error="",this._token=""},ajaxError:function(e,t,r,n){var i,o=this;return 409===e.status&&(i=e.getResponseHeader("X-Transmission-Session-Id"))?(o._token=i,void $.ajax(n)):(o._error=e.responseText?e.responseText.trim().replace(/(<([^>]+)>)/gi,""):"",o._error.length||(o._error="Server not responding"),dialog.confirm("连接失败","无法连接到服务器. 你可能需要通过刷新页面来重新连接。","详情",function(){alert(o._error)},"关闭"),void o._controller.togglePeriodicSessionRefresh(!1))},appendSessionId:function(e){this._token&&e.setRequestHeader("X-Transmission-Session-Id",this._token)},sendRequest:function(e,t,r,n){var i=this;"boolean"!=typeof n&&(n=!0);var o={url:RPC._Root,type:"POST",contentType:"json",dataType:"json",cache:!1,data:JSON.stringify(e),beforeSend:function(e){i.appendSessionId(e)},error:function(e,t,r){i.ajaxError(e,t,r,o)},success:t,context:r,async:n};$.ajax(o)},loadDaemonPrefs:function(e,t,r){var n={method:"session-get"};this.sendRequest(n,e,t,r)},checkPort:function(e,t,r){var n={method:"port-test"};this.sendRequest(n,e,t,r)},renameTorrent:function(e,t,r,n,i){var o={method:"torrent-rename-path",arguments:{ids:e,path:t,name:r}};this.sendRequest(o,n,i)},loadDaemonStats:function(e,t,r){var n={method:"session-stats"};this.sendRequest(n,e,t,r)},updateTorrents:function(e,t,r,n){var i={method:"torrent-get",arguments:{fields:t}};e&&(i.arguments.ids=e),this.sendRequest(i,function(e){var t=e.arguments;r.call(n,t.torrents,t.removed)})},getFreeSpace:function(e,t,r){var n={method:"free-space",arguments:{path:e}};this.sendRequest(n,function(e){var n=e.arguments;t.call(r,n.path,n["size-bytes"])})},changeFileCommand:function(e,t,r){var n=this,i={ids:[e]};i[r]=t,this.sendRequest({arguments:i,method:"torrent-set"},function(){n._controller.refreshTorrents([e])})},sendTorrentSetRequests:function(e,t,r,n,i){r||(r={}),r.ids=t;var o={method:e,arguments:r};this.sendRequest(o,n,i)},sendTorrentActionRequests:function(e,t,r,n){this.sendTorrentSetRequests(e,t,null,r,n)},startTorrents:function(e,t,r,n){var i=t?"torrent-start-now":"torrent-start";this.sendTorrentActionRequests(i,e,r,n)},stopTorrents:function(e,t,r){this.sendTorrentActionRequests("torrent-stop",e,t,r)},moveTorrents:function(e,t,r,n){this.sendTorrentSetRequests("torrent-set-location",e,{move:!0,location:t},r,n)},removeTorrents:function(e,t,r){this.sendTorrentActionRequests("torrent-remove",e,t,r)},removeTorrentsAndData:function(e){var t=this,r={method:"torrent-remove",arguments:{"delete-local-data":!0,ids:[]}};if(e)for(var n=0,i=e.length;n<i;++n)r.arguments.ids.push(e[n].getId());this.sendRequest(r,function(){t._controller.refreshTorrents()})},verifyTorrents:function(e,t,r){this.sendTorrentActionRequests("torrent-verify",e,t,r)},reannounceTorrents:function(e,t,r){this.sendTorrentActionRequests("torrent-reannounce",e,t,r)},addTorrentByUrl:function(e,t){var r=this;e.match(/^[0-9a-f]{40}$/i)&&(e="magnet:?xt=urn:btih:"+e);var n={method:"torrent-add",arguments:{paused:t.paused,filename:e}};this.sendRequest(n,function(){r._controller.refreshTorrents()})},savePrefs:function(e){var t=this,r={method:"session-set",arguments:e};this.sendRequest(r,function(){t._controller.loadDaemonPrefs()})},updateBlocklist:function(){var e=this,t={method:"blocklist-update"};this.sendRequest(t,function(){e._controller.loadDaemonPrefs()})},moveTorrentsToTop:function(e,t,r){this.sendTorrentActionRequests(RPC._QueueMoveTop,e,t,r)},moveTorrentsToBottom:function(e,t,r){this.sendTorrentActionRequests(RPC._QueueMoveBottom,e,t,r)},moveTorrentsUp:function(e,t,r){this.sendTorrentActionRequests(RPC._QueueMoveUp,e,t,r)},moveTorrentsDown:function(e,t,r){this.sendTorrentActionRequests(RPC._QueueMoveDown,e,t,r)}},Transmission.prototype={initialize:function(){var e;this.remote=new TransmissionRemote(this),this.inspector=new Inspector(this,this.remote),this.prefsDialog=new PrefsDialog(this.remote),$(this.prefsDialog).bind("closed",$.proxy(this.onPrefsDialogClosed,this)),this.isMenuEnabled=!isMobileDevice,this.filterText="",this._torrents={},this._rows=[],this.dirtyTorrents={},this.uriCache={},Prefs.getClutchPrefs(this),$("#toolbar-pause").click($.proxy(this.stopSelectedClicked,this)),$("#toolbar-start").click($.proxy(this.startSelectedClicked,this)),$("#toolbar-pause-all").click($.proxy(this.stopAllClicked,this)),$("#toolbar-start-all").click($.proxy(this.startAllClicked,this)),$("#toolbar-remove").click($.proxy(this.removeClicked,this)),$("#toolbar-open").click($.proxy(this.openTorrentClicked,this)),$("#prefs-button").click($.proxy(this.togglePrefsDialogClicked,this)),$("#upload_confirm_button").click($.proxy(this.confirmUploadClicked,this)),$("#upload_cancel_button").click($.proxy(this.hideUploadDialog,this)),$("#rename_confirm_button").click($.proxy(this.confirmRenameClicked,this)),$("#rename_cancel_button").click($.proxy(this.hideRenameDialog,this)),$("#move_confirm_button").click($.proxy(this.confirmMoveClicked,this)),$("#move_cancel_button").click($.proxy(this.hideMoveDialog,this)),$("#turtle-button").click($.proxy(this.toggleTurtleClicked,this)),$("#compact-button").click($.proxy(this.toggleCompactClicked,this)),jQuery.event.props.push("dataTransfer"),$("#torrent_upload_form").submit(function(){return $("#upload_confirm_button").click(),!1}),$("#toolbar-inspector").click($.proxy(this.toggleInspector,this)),e=$("#filter-mode"),e.val(this[Prefs._FilterMode]),e.change($.proxy(this.onFilterModeClicked,this)),$("#filter-tracker").change($.proxy(this.onFilterTrackerClicked,this)),isMobileDevice||($(document).bind("keydown",$.proxy(this.keyDown,this)),$(document).bind("keyup",$.proxy(this.keyUp,this)),$("#torrent_container").click($.proxy(this.deselectAll,this)),$("#torrent_container").bind("dragover",$.proxy(this.dragenter,this)),$("#torrent_container").bind("dragenter",$.proxy(this.dragenter,this)),$("#torrent_container").bind("drop",$.proxy(this.drop,this)),$("#inspector_link").click($.proxy(this.toggleInspector,this)),this.setupSearchBox(),this.createContextMenu()),this.isMenuEnabled&&this.createSettingsMenu(),e={},e.torrent_list=$("#torrent_list")[0],e.toolbar_buttons=$("#toolbar ul li"),e.toolbar_pause_button=$("#toolbar-pause")[0],e.toolbar_start_button=$("#toolbar-start")[0],e.toolbar_remove_button=$("#toolbar-remove")[0],this.elements=e,this.initializeSettings();var t=!1;this.loadDaemonPrefs(t),this.loadDaemonStats(t),this.initializeTorrents(),this.refreshTorrents(),this.togglePeriodicSessionRefresh(!0),this.updateButtonsSoon()},loadDaemonPrefs:function(e){this.remote.loadDaemonPrefs(function(e){var t=e.arguments;Prefs.getClutchPrefs(t),this.updateGuiFromSession(t),this.sessionProperties=t},this,e)},loadImages:function(){for(var e,t=0;e=arguments[t];++t)jQuery("<img>").attr("src",e)},initializeSettings:function(){Prefs.getClutchPrefs(this),this.isMenuEnabled&&($("#sort_by_"+this[Prefs._SortMethod]).selectMenuItem(),this[Prefs._SortDirection]===Prefs._SortDescending&&$("#reverse_sort_order").selectMenuItem()),this.initCompactMode()},setupSearchBox:function(){var e=this,t=$("#torrent_search");t.bind("keyup click",function(){e.setFilterText(this.value)}),$.browser.safari||(t.addClass("blur"),t[0].value="Filter",t.bind("blur",function(){""===this.value&&($(this).addClass("blur"),this.value="Filter",e.setFilterText(null))}).bind("focus",function(){$(this).is(".blur")&&(this.value="",$(this).removeClass("blur"))}))},createContextMenu:function(){var e=this,t={pause_selected:function(){e.stopSelectedTorrents()},resume_selected:function(){e.startSelectedTorrents(!1)},resume_now_selected:function(){e.startSelectedTorrents(!0)},move:function(){e.moveSelectedTorrents(!1)},remove:function(){e.removeSelectedTorrents()},remove_data:function(){e.removeSelectedTorrentsAndData()},verify:function(){e.verifySelectedTorrents()},rename:function(){e.renameSelectedTorrents()},reannounce:function(){e.reannounceSelectedTorrents()},move_top:function(){e.moveTop()},move_up:function(){e.moveUp()},move_down:function(){e.moveDown()},move_bottom:function(){e.moveBottom()},select_all:function(){e.selectAll()},deselect_all:function(){e.deselectAll()}};$("ul#torrent_list").contextmenu({delegate:".torrent",menu:"#torrent_context_menu",preventSelect:!0,taphold:!0,show:{effect:"none"},hide:{effect:"none"},select:function(e,r){t[r.cmd]()},beforeOpen:$.proxy(function(e,t){var r=$(e.currentTarget),n=$("#torrent_list > li").index(r);n===-1||this._rows[n].isSelected()||this.setSelectedRow(this._rows[n]),this.calculateTorrentStates(function(t){var r=$(e.target);r.contextmenu("enableEntry","pause_selected",t.activeSel>0),r.contextmenu("enableEntry","resume_selected",t.pausedSel>0),r.contextmenu("enableEntry","resume_now_selected",t.pausedSel>0||t.queuedSel>0),r.contextmenu("enableEntry","rename",1==t.sel);
})},this)})},createSettingsMenu:function(){$("#footer_super_menu").transMenu({open:function(){$("#settings_menu").addClass("selected")},close:function(){$("#settings_menu").removeClass("selected")},select:$.proxy(this.onMenuClicked,this)}),$("#settings_menu").click(function(e){$("#footer_super_menu").transMenu("open")})},updateFreeSpaceInAddDialog:function(){var e=$("input#add-dialog-folder-input").val();this.remote.getFreeSpace(e,this.onFreeSpaceResponse,this)},onFreeSpaceResponse:function(e,t){var r,n,i;i=$("input#add-dialog-folder-input").val(),i==e&&(r=$("label#add-dialog-folder-label"),n=t>0?"  <i>("+Transmission.fmt.size(t)+" Free)</i>":"",r.html("Destination folder"+n+":"))},getAllTorrents:function(){var e=[];for(var t in this._torrents)e.push(this._torrents[t]);return e},getTorrentIds:function(e){return $.map(e.slice(0),function(e){return e.getId()})},scrollToRow:function(e){if(!isMobileDevice){var t=$("#torrent_container"),r=t.scrollTop(),n=t.innerHeight(),i=e.getElement().offsetTop,o=$(e.getElement()).outerHeight();i<r?t.scrollTop(i):n+r<i+o&&t.scrollTop(i+o-n)}},seedRatioLimit:function(){var e=this.sessionProperties;return e&&e.seedRatioLimited?e.seedRatioLimit:-1},setPref:function(e,t){this[e]=t,Prefs.setValue(e,t)},getSelectedRows:function(){return $.grep(this._rows,function(e){return e.isSelected()})},getSelectedTorrents:function(){return $.map(this.getSelectedRows(),function(e){return e.getTorrent()})},getSelectedTorrentIds:function(){return this.getTorrentIds(this.getSelectedTorrents())},setSelectedRow:function(e){$(this.elements.torrent_list).children(".selected").removeClass("selected"),this.selectRow(e)},selectRow:function(e){$(e.getElement()).addClass("selected"),this.callSelectionChangedSoon()},deselectRow:function(e){$(e.getElement()).removeClass("selected"),this.callSelectionChangedSoon()},selectAll:function(){$(this.elements.torrent_list).children().addClass("selected"),this.callSelectionChangedSoon()},deselectAll:function(){$(this.elements.torrent_list).children(".selected").removeClass("selected"),this.callSelectionChangedSoon(),delete this._last_torrent_clicked},indexOfLastTorrent:function(){for(var e,t=0;e=this._rows[t];++t)if(e.getTorrentId()===this._last_torrent_clicked)return t;return-1},selectRange:function(e){var t=this.indexOfLastTorrent();if(t===-1)this.selectRow(e);else for(var r=this._rows.indexOf(e),n=Math.min(t,r),i=Math.max(t,r),o=n;o<=i;++o)this.selectRow(this._rows[o]);this.callSelectionChangedSoon()},selectionChanged:function(){this.updateButtonStates(),this.inspector.setTorrents(this.inspectorIsVisible()?this.getSelectedTorrents():[]),clearTimeout(this.selectionChangedTimer),delete this.selectionChangedTimer},callSelectionChangedSoon:function(){if(!this.selectionChangedTimer){var e=$.proxy(this.selectionChanged,this),t=200;this.selectionChangedTimer=setTimeout(e,t)}},keyDown:function(e){var t=!1,r=this._rows,n=38===e.keyCode,i=40===e.keyCode,o=16===e.keyCode;if((n||i)&&r.length){var s,a=this.indexOfLastTorrent(),l=a,d=this._shift_index,c=0,u=r.length-1;i&&l+1<=u?++l:n&&l-1>=c&&--l;var s=r[l];d>=0?d<=a&&a<l||d>=a&&a>l?this.selectRow(s):(d>=a&&l>a||d<=a&&a>l)&&this.deselectRow(r[a]):e.shiftKey?this.selectRange(s):this.setSelectedRow(s),this._last_torrent_clicked=s.getTorrentId(),this.scrollToRow(s),t=!0}else o&&(this._shift_index=this.indexOfLastTorrent());return!t},keyUp:function(e){16===e.keyCode&&delete this._shift_index},isButtonEnabled:function(e){var t=(e.target||e.srcElement).parentNode;return"disabled"!==t.className&&"disabled"!==t.parentNode.className},stopSelectedClicked:function(e){this.isButtonEnabled(e)&&(this.stopSelectedTorrents(),this.hideMobileAddressbar())},startSelectedClicked:function(e){this.isButtonEnabled(e)&&(this.startSelectedTorrents(!1),this.hideMobileAddressbar())},stopAllClicked:function(e){this.isButtonEnabled(e)&&(this.stopAllTorrents(),this.hideMobileAddressbar())},startAllClicked:function(e){this.isButtonEnabled(e)&&(this.startAllTorrents(!1),this.hideMobileAddressbar())},openTorrentClicked:function(e){this.isButtonEnabled(e)&&($("body").addClass("open_showing"),this.uploadTorrentFile(),this.updateButtonStates())},dragenter:function(e){if(e.dataTransfer&&e.dataTransfer.types){for(var t=["text/uri-list","text/plain"],r=0;r<t.length;++r)if(e.dataTransfer.types.contains(t[r]))return e.stopPropagation(),e.preventDefault(),e.dropEffect="copy",!1}else e.dataTransfer&&(e.dataTransfer.dropEffect="none");return!0},drop:function(e){var t,r,n=null,i=["text/uri-list","text/plain"],o=this.shouldAddedTorrentsStart();if(!e.dataTransfer||!e.dataTransfer.types)return!0;for(t=0;!n&&t<i.length;++t)e.dataTransfer.types.contains(i[t])&&(n=e.dataTransfer.getData(i[t]).split("\n"));for(t=0;r=n[t];++t)/^#/.test(r)||/^[a-z-]+:/i.test(r)&&this.remote.addTorrentByUrl(r,o);return e.preventDefault(),!1},hideUploadDialog:function(){$("body.open_showing").removeClass("open_showing"),$("#upload_container").hide(),this.updateButtonStates()},confirmUploadClicked:function(){this.uploadTorrentFile(!0),this.hideUploadDialog()},hideMoveDialog:function(){$("#move_container").hide(),this.updateButtonStates()},confirmMoveClicked:function(){this.moveSelectedTorrents(!0),this.hideUploadDialog()},hideRenameDialog:function(){$("body.open_showing").removeClass("open_showing"),$("#rename_container").hide()},confirmRenameClicked:function(){var e=this.getSelectedTorrents();this.renameTorrent(e[0],$("input#torrent_rename_name").attr("value")),this.hideRenameDialog()},removeClicked:function(e){this.isButtonEnabled(e)&&(this.removeSelectedTorrents(),this.hideMobileAddressbar())},togglePeriodicSessionRefresh:function(e){if(clearInterval(this.sessionInterval),delete this.sessionInterval,e){var t=$.proxy(this.loadDaemonPrefs,this),r=8e3;this.sessionInterval=setInterval(t,r)}},toggleTurtleClicked:function(){var e={};e[RPC._TurtleState]=!$("#turtle-button").hasClass("selected"),this.remote.savePrefs(e)},onPrefsDialogClosed:function(){$("#prefs-button").removeClass("selected")},togglePrefsDialogClicked:function(e){var t=$("#prefs-button");t.hasClass("selected")?this.prefsDialog.close():(t.addClass("selected"),this.prefsDialog.show())},setFilterText:function(e){this.filterText=e?e.trim():null,this.refilter(!0)},setSortMethod:function(e){this.setPref(Prefs._SortMethod,e),this.refilter(!0)},setSortDirection:function(e){this.setPref(Prefs._SortDirection,e),this.refilter(!0)},onMenuClicked:function(e,t){var r,n,i=t.id,o=this.remote,s=t.target;if("sort-mode"==t.group)s.selectMenuItem(),this.setSortMethod(i.replace(/sort_by_/,""));else if(s.hasClass("upload-speed"))r={},r[RPC._UpSpeedLimit]=parseInt(s.text()),r[RPC._UpSpeedLimited]=!0,o.savePrefs(r);else if(s.hasClass("download-speed"))r={},r[RPC._DownSpeedLimit]=parseInt(s.text()),r[RPC._DownSpeedLimited]=!0,o.savePrefs(r);else switch(i){case"statistics":this.showStatsDialog();break;case"about-button":r="Transmission "+this.serverVersion,$("#about-dialog #about-title").html(r),$("#about-dialog").dialog({title:"关于",show:"fade",hide:"fade"});break;case"homepage":window.open("http://www.transmissionbt.com/");break;case"tipjar":window.open("http://www.transmissionbt.com/donate.php");break;case"unlimited_download_rate":r={},r[RPC._DownSpeedLimited]=!1,o.savePrefs(r);break;case"limited_download_rate":r={},r[RPC._DownSpeedLimited]=!0,o.savePrefs(r);break;case"unlimited_upload_rate":r={},r[RPC._UpSpeedLimited]=!1,o.savePrefs(r);break;case"limited_upload_rate":r={},r[RPC._UpSpeedLimited]=!0,o.savePrefs(r);break;case"reverse_sort_order":s.menuItemIsSelected()?(n=Prefs._SortAscending,s.deselectMenuItem()):(n=Prefs._SortDescending,s.selectMenuItem()),this.setSortDirection(n);break;case"toggle_notifications":Notifications&&Notifications.toggle();break;default:console.log("unhandled: "+i)}},onTorrentChanged:function(e,t){this.dirtyTorrents[t.getId()]=!0,this.refilterSoon(),this.updateButtonsSoon()},updateFromTorrentGet:function(e,t){var r,n,i,o,s,a,l,d=[];for(r=0;n=e[r];++r)o=n.id,(i=this._torrents[o])?(s=i.needsMetaData(),i.refresh(n),s&&!i.needsMetaData()&&d.push(o)):(i=this._torrents[o]=new Torrent(n),this.dirtyTorrents[o]=!0,a=$.proxy(this.onTorrentChanged,this),$(i).bind("dataChanged",a),"name"in i.fields&&"status"in i.fields||d.push(o),i.notifyOnFieldChange("status",$.proxy(function(e,t){t!==Torrent._StatusDownload||e!=Torrent._StatusSeed&&e!=Torrent._StatusSeedWait?t===Torrent._StatusSeed&&e===Torrent._StatusStopped&&i.isFinished()?$(this).trigger("seedingComplete",[i]):$(this).trigger("statusChange",[i]):$(this).trigger("downloadComplete",[i])},this)));d.length&&(l=["id"].concat(Torrent.Fields.Metadata,Torrent.Fields.Stats),this.updateTorrents(d,l),this.refilterSoon()),t&&(this.deleteTorrents(t),this.refilterSoon())},updateTorrents:function(e,t){this.remote.updateTorrents(e,t,this.updateFromTorrentGet,this)},refreshTorrents:function(){var e=$.proxy(this.refreshTorrents,this),t=1e3*this[Prefs._RefreshRate],r=["id"].concat(Torrent.Fields.Stats);this.updateTorrents("recently-active",r),clearTimeout(this.refreshTorrentsTimeout),this.refreshTorrentsTimeout=setTimeout(e,t)},initializeTorrents:function(){var e=["id"].concat(Torrent.Fields.Metadata,Torrent.Fields.Stats);this.updateTorrents(null,e)},onRowClicked:function(e){var t=e.metaKey||e.ctrlKey,r=e.currentTarget.row;return"torrent_resume icon-start-deep"===e.target.className?void this.startTorrent(r.getTorrent()):"torrent_pause icon-pause-deep"===e.target.className?void this.stopTorrent(r.getTorrent()):(e.stopPropagation(),isMobileDevice?(r.isSelected()&&this.setInspectorVisible(!0),this.setSelectedRow(r)):e.shiftKey?(this.selectRange(r),window.focus()):!r.isSelected()&&t?this.selectRow(r):r.isSelected()?r.isSelected()&&t?this.deselectRow(r):r.isSelected()&&this.setSelectedRow(r):this.setSelectedRow(r),void(this._last_torrent_clicked=r.getTorrentId()))},deleteTorrents:function(e){var t,r;if(e&&e.length){for(t=0;r=e[t];++t)this.dirtyTorrents[r]=!0,delete this._torrents[r];this.refilter()}},shouldAddedTorrentsStart:function(){return this.prefsDialog.shouldAddedTorrentsStart()},uploadTorrentFile:function(e){var t=$("input#torrent_upload_file"),r=$("input#add-dialog-folder-input"),n=$("input#torrent_auto_start"),i=$("input#torrent_upload_url");if(e){var o=!n.is(":checked"),s=r.val(),a=this.remote;jQuery.each(t[0].files,function(e,t){var r=new FileReader;r.onload=function(e){var r=e.target.result,n="base64,",i=r.indexOf(n);if(i>-1){var l=r.substring(i+n.length),d={method:"torrent-add",arguments:{paused:o,"download-dir":s,metainfo:l}};a.sendRequest(d,function(e){"success"!=e.result&&alert('Error adding "'+t.name+'": '+e.result)})}},r.readAsDataURL(t)});var l=$("#torrent_upload_url").val();if(""!=l){l.match(/^[0-9a-f]{40}$/i)&&(l="magnet:?xt=urn:btih:"+l);var d={method:"torrent-add",arguments:{paused:o,"download-dir":s,filename:l}};a.sendRequest(d,function(e){"success"!=e.result&&alert('Error adding "'+l+'": '+e.result)})}}else t.attr("value",""),i.attr("value",""),n.attr("checked",this.shouldAddedTorrentsStart()),r.attr("value",$("#download-dir").val()),r.change($.proxy(this.updateFreeSpaceInAddDialog,this)),this.updateFreeSpaceInAddDialog(),$("#upload_container").show(),i.focus()},promptSetLocation:function(e,t){if(e){var r=this.getTorrentIds(t);this.remote.moveTorrents(r,$("input#torrent_path").val(),this.refreshTorrents,this),$("#move_container").hide()}else{var n;n=1===t.length?t[0].getDownloadDir():$("#download-dir").val(),$("input#torrent_path").attr("value",n),$("#move_container").show(),$("#torrent_path").focus()}},moveSelectedTorrents:function(e){var t=this.getSelectedTorrents();t.length&&this.promptSetLocation(e,t)},removeSelectedTorrents:function(){var e=this.getSelectedTorrents();e.length&&this.promptToRemoveTorrents(e)},removeSelectedTorrentsAndData:function(){var e=this.getSelectedTorrents();e.length&&this.promptToRemoveTorrentsAndData(e)},promptToRemoveTorrents:function(e){if(1===e.length){var t=e[0],r="移除 "+t.getName()+"?",n="一旦移除，继续下载时将会需要种子文件，你确定要移除任务吗？";dialog.confirm(r,n,"移除",function(){transmission.removeTorrents(e)})}else{var r="移除 "+e.length+" 传输任务?",n="一旦移除，继续下载时将会需要种子文件，你确定要移除这些任务吗？";dialog.confirm(r,n,"移除",function(){transmission.removeTorrents(e)})}},promptToRemoveTorrentsAndData:function(e){if(1===e.length){var t=e[0],r="移除 "+t.getName()+" 并删除数据?",n="所有关于此种子的已下载数据将会被删除，你确定要删除吗？";dialog.confirm(r,n,"移除",function(){transmission.removeTorrentsAndData(e)})}else{var r="移除 "+e.length+" 传输任务并删除数据?",n="所有关于这些种子的已下载数据将会被删除，你确定要删除他们吗?";dialog.confirm(r,n,"移除",function(){transmission.removeTorrentsAndData(e)})}},removeTorrents:function(e){var t=this.getTorrentIds(e);this.remote.removeTorrents(t,this.refreshTorrents,this)},removeTorrentsAndData:function(e){this.remote.removeTorrentsAndData(e)},promptToRenameTorrent:function(e){$("body").addClass("open_showing"),$("input#torrent_rename_name").attr("value",e.getName()),$("#rename_container").show(),$("#torrent_rename_name").focus()},renameSelectedTorrents:function(){var e=this.getSelectedTorrents();1!=e.length?dialog.alert("重命名","一次只能重命名一个任务.","Ok"):this.promptToRenameTorrent(e[0])},onTorrentRenamed:function(e){var t;"success"===e.result&&e.arguments&&(t=this._torrents[e.arguments.id])&&t.refresh(e.arguments)},renameTorrent:function(e,t){var r=e.getName();this.remote.renameTorrent([e.getId()],r,t,this.onTorrentRenamed,this)},verifySelectedTorrents:function(){this.verifyTorrents(this.getSelectedTorrents())},reannounceSelectedTorrents:function(){this.reannounceTorrents(this.getSelectedTorrents())},startAllTorrents:function(e){this.startTorrents(this.getAllTorrents(),e)},startSelectedTorrents:function(e){this.startTorrents(this.getSelectedTorrents(),e)},startTorrent:function(e){this.startTorrents([e],!1)},startTorrents:function(e,t){this.remote.startTorrents(this.getTorrentIds(e),t,this.refreshTorrents,this)},verifyTorrent:function(e){this.verifyTorrents([e])},verifyTorrents:function(e){this.remote.verifyTorrents(this.getTorrentIds(e),this.refreshTorrents,this)},reannounceTorrent:function(e){this.reannounceTorrents([e])},reannounceTorrents:function(e){this.remote.reannounceTorrents(this.getTorrentIds(e),this.refreshTorrents,this)},stopAllTorrents:function(){this.stopTorrents(this.getAllTorrents())},stopSelectedTorrents:function(){this.stopTorrents(this.getSelectedTorrents())},stopTorrent:function(e){this.stopTorrents([e])},stopTorrents:function(e){this.remote.stopTorrents(this.getTorrentIds(e),this.refreshTorrents,this)},changeFileCommand:function(e,t,r){this.remote.changeFileCommand(e,t,r)},hideMobileAddressbar:function(e){if(isMobileDevice&&!scroll_timeout){var t=$.proxy(this.doToolbarHide,this),r=1e3*e||150;scroll_timeout=setTimeout(t,r)}},doToolbarHide:function(){window.scrollTo(0,1),scroll_timeout=null},moveTop:function(){this.remote.moveTorrentsToTop(this.getSelectedTorrentIds(),this.refreshTorrents,this)},moveUp:function(){this.remote.moveTorrentsUp(this.getSelectedTorrentIds(),this.refreshTorrents,this)},moveDown:function(){this.remote.moveTorrentsDown(this.getSelectedTorrentIds(),this.refreshTorrents,this)},moveBottom:function(){this.remote.moveTorrentsToBottom(this.getSelectedTorrentIds(),this.refreshTorrents,this)},updateGuiFromSession:function(e){var t,r,n,i,o,s=Transmission.fmt,a=$("#footer_super_menu");this.serverVersion=e.version,this.prefsDialog.set(e),RPC._TurtleState in e&&(i=e[RPC._TurtleState],n=$("#turtle-button"),o=["Click to ",i?"disable":"enable"," Temporary Speed Limits (",s.speed(e[RPC._TurtleUpSpeedLimit])," up,",s.speed(e[RPC._TurtleDownSpeedLimit])," down)"].join(""),n.toggleClass("selected",i),n.attr("title",o)),this.isMenuEnabled&&RPC._DownSpeedLimited in e&&RPC._DownSpeedLimit in e&&(t=e[RPC._DownSpeedLimit],r=e[RPC._DownSpeedLimited],n=a.find("#limited_download_rate"),n.html("Limit ("+s.speed(t)+")"),r||(n=a.find("#unlimited_download_rate")),n.selectMenuItem()),this.isMenuEnabled&&RPC._UpSpeedLimited in e&&RPC._UpSpeedLimit in e&&(t=e[RPC._UpSpeedLimit],r=e[RPC._UpSpeedLimited],n=a.find("#limited_upload_rate"),n.html("Limit ("+s.speed(t)+")"),r||(n=a.find("#unlimited_upload_rate")),n.selectMenuItem())},updateStatusbar:function(){var e,t,r=0,n=0,i=Transmission.fmt,o=this.getAllTorrents();for(e=0;t=o[e];++e)r+=t.getUploadSpeed(),n+=t.getDownloadSpeed();$("#speed-up-container").toggleClass("active",r>0),$("#speed-up-label").text(i.speedBps(r)),$("#speed-dn-container").toggleClass("active",n>0),$("#speed-dn-label").text(i.speedBps(n)),$("#filter-count").text(i.countString("个传输任务","个传输任务",this._rows.length))},setEnabled:function(e,t){$(e).toggleClass("disabled",!t)},updateFilterSelect:function(){var e,t,r,n,i,o=($("#filter-tracker"),this.getTrackers());t=[];for(r in o)t.push(r);for(t.sort(),n=this.filterTracker?'<option value="all">All</option>':'<option value="all" selected="selected">All</option>',e=0;r=t[e];++e)i=o[r],n+='<option value="'+i.domain+'"',o[r].domain===this.filterTracker&&(n+=' selected="selected"'),n+=">"+r+"</option>";this.filterTrackersStr&&this.filterTrackersStr===n||(this.filterTrackersStr=n,$("#filter-tracker").html(n))},updateButtonsSoon:function(){if(!this.buttonRefreshTimer){var e=$.proxy(this.updateButtonStates,this),t=100;this.buttonRefreshTimer=setTimeout(e,t)}},calculateTorrentStates:function(e){var t={total:0,active:0,paused:0,sel:0,activeSel:0,pausedSel:0,queuedSel:0};clearTimeout(this.buttonRefreshTimer),delete this.buttonRefreshTimer;for(var r,n=0;r=this._rows[n];++n){var i=r.getTorrent().isStopped(),o=r.isSelected(),s=r.getTorrent().isQueued();++t.total,i||++t.active,i&&++t.paused,o&&++t.sel,o&&!i&&++t.activeSel,o&&i&&++t.pausedSel,o&&s&&++t.queuedSel}e(t)},updateButtonStates:function(){var e=this,t=this.elements;this.calculateTorrentStates(function(r){e.setEnabled(t.toolbar_pause_button,r.activeSel>0),e.setEnabled(t.toolbar_start_button,r.pausedSel>0),e.setEnabled(t.toolbar_remove_button,r.sel>0)})},inspectorIsVisible:function(){return $("#torrent_inspector").is(":visible")},toggleInspector:function(){this.setInspectorVisible(!this.inspectorIsVisible())},setInspectorVisible:function(e){if(e&&this.inspector.setTorrents(this.getSelectedTorrents()),$("#torrent_inspector").toggle(e),$("#toolbar-inspector").toggleClass("selected",e),this.hideMobileAddressbar(),isMobileDevice)$("body").toggleClass("inspector_showing",e);else{var t=e?$("#torrent_inspector").outerWidth()+1+"px":"0px";$("#torrent_container")[0].style.right=t}},refilterSoon:function(){if(!this.refilterTimer){var e=this,t=function(){e.refilter(!1)},r=100;this.refilterTimer=setTimeout(t,r)}},sortRows:function(e){var t,r,n,i={},o=[];for(t=0;n=e[t];++t)r=n.getTorrent(),o.push(r),i[r.getId()]=n;for(Torrent.sortTorrents(o,this[Prefs._SortMethod],this[Prefs._SortDirection]),t=0;r=o[t];++t)e[t]=i[r.getId()]},refilter:function(e){var t,r,n,i,o,s,a,l,d,c,u=this[Prefs._SortMethod],h=this[Prefs._SortDirection],f=this[Prefs._FilterMode],p=this.filterText,m=this.filterTracker,g=this.torrentRenderer,_=this.elements.torrent_list,T=$(_).children(".selected").length;if(this.updateFilterSelect(),clearTimeout(this.refilterTimer),delete this.refilterTimer,e){$(_).empty(),this._rows=[];for(n in this._torrents)this.dirtyTorrents[n]=!0}for(l=[],d=[],t=0;o=this._rows[t];++t)o.getTorrentId()in this.dirtyTorrents?d.push(o):l.push(o);for(r=[],t=0;o=d[t];++t)r.push(o.getElement());for($(r).detach(),s=[],t=0;o=d[t];++t)n=o.getTorrentId(),i=this._torrents[n],i&&i.test(f,p,m)&&s.push(o),delete this.dirtyTorrents[n];d=s;for(n in this.dirtyTorrents)i=this._torrents[n],i&&i.test(f,p,m)&&(o=new TorrentRow(g,this,i),r=o.getElement(),r.row=o,d.push(o),$(r).click($.proxy(this.onRowClicked,this)),$(r).dblclick($.proxy(this.toggleInspector,this)));this.sortRows(d),a=[];var v=0,S=l.length,b=0,w=d.length;for(c=document.createDocumentFragment();v!=S||b!=w;){var C;if(v==S)C=!1;else if(b==w)C=!0;else{var y=Torrent.compareTorrents(l[v].getTorrent(),d[b].getTorrent(),u,h);C=y<0}C?a.push(l[v++]):(o=d[b++],r=o.getElement(),v!==S?_.insertBefore(r,l[v].getElement()):c.appendChild(r),a.push(o))}for(_.appendChild(c),this._rows=a,this.dirtyTorrents={},r=[],t=0;o=a[t];++t)r.push(o.getElement());$(r).filter(":odd").addClass("even"),$(r).filter(":even").removeClass("even"),this.updateStatusbar(),T!==$(_).children(".selected").length&&this.selectionChanged()},setFilterMode:function(e){this.setPref(Prefs._FilterMode,e),this.refilter(!0)},onFilterModeClicked:function(e){this.setFilterMode($("#filter-mode").val())},onFilterTrackerClicked:function(e){var t=$("#filter-tracker").val();this.setFilterTracker("all"===t?null:t)},setFilterTracker:function(e){var t=e?this.getReadableDomain(e):"all",r="#show-tracker-"+t;$(r).addClass("selected").siblings().removeClass("selected"),this.filterTracker=e,this.refilter(!0)},getDomainName:function(e){var t=e.indexOf(".");return t!==e.lastIndexOf(".")&&(e=e.slice(t+1)),e},getReadableDomain:function(e){e.length&&(e=e.charAt(0).toUpperCase()+e.slice(1));var t=e.indexOf(".");return t!==-1&&(e=e.slice(0,t)),e},getTrackers:function(){for(var e,t={},r=this.getAllTorrents(),n=0;e=r[n];++n){for(var i,o=[],s=e.getTrackers(),a=0;i=s[a];++a){var l,d=i.announce;d in this.uriCache?l=this.uriCache[d]:(l=this.uriCache[d]=parseUri(d),l.domain=this.getDomainName(l.host),l.name=this.getReadableDomain(l.domain)),l.name in t||(t[l.name]={uri:l,domain:l.domain,count:0}),o.indexOf(l.name)===-1&&o.push(l.name)}for(var c,a=0;c=o[a];++a)t[c].count++}return t},toggleCompactClicked:function(){this.setCompactMode(!this[Prefs._CompactDisplayState])},setCompactMode:function(e){var t=Prefs._CompactDisplayState,r=this[t];r!==e&&(this.setPref(t,e),this.onCompactModeChanged())},initCompactMode:function(){this.onCompactModeChanged()},onCompactModeChanged:function(){var e=this[Prefs._CompactDisplayState];$("#compact-button").toggleClass("selected",e),this.torrentRenderer=e?new TorrentRendererCompact:new TorrentRendererFull,this.refilter(!0)},togglePeriodicStatsRefresh:function(e){if(clearInterval(this.statsInterval),delete this.statsInterval,e){var t=$.proxy(this.loadDaemonStats,this),r=5e3;this.statsInterval=setInterval(t,r)}},loadDaemonStats:function(e){this.remote.loadDaemonStats(function(e){this.updateStats(e.arguments)},this,e)},updateStats:function(e){var t,r,n=Transmission.fmt;t=e["current-stats"],r=Math.ratio(t.uploadedBytes,t.downloadedBytes),$("#stats-session-uploaded").html(n.size(t.uploadedBytes)),$("#stats-session-downloaded").html(n.size(t.downloadedBytes)),$("#stats-session-ratio").html(n.ratioString(r)),$("#stats-session-duration").html(n.timeInterval(t.secondsActive)),t=e["cumulative-stats"],r=Math.ratio(t.uploadedBytes,t.downloadedBytes),$("#stats-total-count").html(t.sessionCount+" 次"),$("#stats-total-uploaded").html(n.size(t.uploadedBytes)),$("#stats-total-downloaded").html(n.size(t.downloadedBytes)),$("#stats-total-ratio").html(n.ratioString(r)),$("#stats-total-duration").html(n.timeInterval(t.secondsActive))},showStatsDialog:function(){this.loadDaemonStats(),this.hideMobileAddressbar(),this.togglePeriodicStatsRefresh(!0),$("#stats-dialog").dialog({close:$.proxy(this.onStatsDialogClosed,this),show:"fade",hide:"fade",title:"统计"})},onStatsDialogClosed:function(){this.hideMobileAddressbar(),this.togglePeriodicStatsRefresh(!1)}},Torrent._StatusStopped=0,Torrent._StatusCheckWait=1,Torrent._StatusCheck=2,Torrent._StatusDownloadWait=3,Torrent._StatusDownload=4,Torrent._StatusSeedWait=5,Torrent._StatusSeed=6,Torrent._RatioUseGlobal=0,Torrent._RatioUseLocal=1,Torrent._RatioUnlimited=2,Torrent._ErrNone=0,Torrent._ErrTrackerWarning=1,Torrent._ErrTrackerError=2,Torrent._ErrLocalError=3,Torrent._TrackerInactive=0,Torrent._TrackerWaiting=1,Torrent._TrackerQueued=2,Torrent._TrackerActive=3,Torrent.Fields={},Torrent.Fields.Metadata=["addedDate","name","totalSize"],Torrent.Fields.Stats=["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],Torrent.Fields.InfoExtra=["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"],Torrent.Fields.StatsExtra=["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"],Torrent.prototype={initialize:function(e){this.fields={},this.fieldObservers={},this.refresh(e)},notifyOnFieldChange:function(e,t){this.fieldObservers[e]=this.fieldObservers[e]||[],this.fieldObservers[e].push(t)},setField:function(e,t,r){var n,i;if(e[t]===r)return!1;if(e==this.fields&&this.fieldObservers[t]&&this.fieldObservers[t].length)for(n=0;i=this.fieldObservers[t][n];++n)i.call(this,r,e[t],t);return e[t]=r,!0},updateFiles:function(e){var t,r,n,i,o,s=!1,a=this.fields.files||[],l=["length","name","bytesCompleted","wanted","priority"];for(t=0;r=e[t];++t){for(o=a[t]||{},n=0;i=l[n];++n)i in r&&(s|=this.setField(o,i,r[i]));a[t]=o}return this.fields.files=a,s},collateTrackers:function(e){var t,r,n=[];for(t=0;r=e[t];++t)n.push(r.announce.toLowerCase());return n.join("\t")},refreshFields:function(e){var t,r=!1;for(t in e)switch(t){case"files":case"fileStats":r|=this.updateFiles(e[t]);break;case"trackerStats":r|=this.setField(this.fields,"trackers",e[t]);break;case"trackers":t in this.fields||(r|=this.setField(this.fields,t,e[t]));break;default:r|=this.setField(this.fields,t,e[t])}return r},refresh:function(e){this.refreshFields(e)&&$(this).trigger("dataChanged",this)},getComment:function(){return this.fields.comment},getCreator:function(){return this.fields.creator},getDateAdded:function(){return this.fields.addedDate},getDateCreated:function(){return this.fields.dateCreated},getDesiredAvailable:function(){return this.fields.desiredAvailable},getDownloadDir:function(){return this.fields.downloadDir},getDownloadSpeed:function(){return this.fields.rateDownload},getDownloadedEver:function(){return this.fields.downloadedEver},getError:function(){return this.fields.error},getErrorString:function(){return this.fields.errorString},getETA:function(){return this.fields.eta},getFailedEver:function(e){return this.fields.corruptEver},getFile:function(e){return this.fields.files[e]},getFileCount:function(){return this.fields.files?this.fields.files.length:0},getHashString:function(){return this.fields.hashString},getHave:function(){return this.getHaveValid()+this.getHaveUnchecked()},getHaveUnchecked:function(){return this.fields.haveUnchecked},getHaveValid:function(){return this.fields.haveValid},getId:function(){return this.fields.id},getLastActivity:function(){return this.fields.activityDate},getLeftUntilDone:function(){return this.fields.leftUntilDone},getMetadataPercentComplete:function(){return this.fields.metadataPercentComplete},getName:function(){return this.fields.name||"Unknown"},getPeers:function(){return this.fields.peers},getPeersConnected:function(){return this.fields.peersConnected},getPeersGettingFromUs:function(){return this.fields.peersGettingFromUs},getPeersSendingToUs:function(){return this.fields.peersSendingToUs},getPieceCount:function(){return this.fields.pieceCount},getPieceSize:function(){return this.fields.pieceSize},getPrivateFlag:function(){return this.fields.isPrivate},getQueuePosition:function(){return this.fields.queuePosition},getRecheckProgress:function(){return this.fields.recheckProgress},getSeedRatioLimit:function(){return this.fields.seedRatioLimit},getSeedRatioMode:function(){return this.fields.seedRatioMode},getSizeWhenDone:function(){return this.fields.sizeWhenDone},getStartDate:function(){return this.fields.startDate},getStatus:function(){return this.fields.status},getTotalSize:function(){return this.fields.totalSize},getTrackers:function(){return this.fields.trackers},getUploadSpeed:function(){return this.fields.rateUpload},getUploadRatio:function(){return this.fields.uploadRatio},getUploadedEver:function(){return this.fields.uploadedEver},getWebseedsSendingToUs:function(){return this.fields.webseedsSendingToUs},isFinished:function(){return this.fields.isFinished},hasExtraInfo:function(){return"hashString"in this.fields},isSeeding:function(){return this.getStatus()===Torrent._StatusSeed},isStopped:function(){return this.getStatus()===Torrent._StatusStopped},isChecking:function(){return this.getStatus()===Torrent._StatusCheck},isDownloading:function(){return this.getStatus()===Torrent._StatusDownload},isQueued:function(){return this.getStatus()===Torrent._StatusDownloadWait||this.getStatus()===Torrent._StatusSeedWait},isDone:function(){return this.getLeftUntilDone()<1},needsMetaData:function(){return this.getMetadataPercentComplete()<1},getActivity:function(){return this.getDownloadSpeed()+this.getUploadSpeed()},getPercentDoneStr:function(){return Transmission.fmt.percentString(100*this.getPercentDone())},getPercentDone:function(){return this.fields.percentDone},getStateString:function(){switch(this.getStatus()){case Torrent._StatusStopped:return this.isFinished()?"做种完毕":"已暂停";case Torrent._StatusCheckWait:return"验证排队";case Torrent._StatusCheck:return"正在验证本地数据";case Torrent._StatusDownloadWait:return"下载排队";case Torrent._StatusDownload:return"下载中";case Torrent._StatusSeedWait:return"做种排队";case Torrent._StatusSeed:return"做种";case null:case void 0:return"未知";default:return"错误"}},seedRatioLimit:function(e){switch(this.getSeedRatioMode()){case Torrent._RatioUseGlobal:return e.seedRatioLimit();case Torrent._RatioUseLocal:return this.getSeedRatioLimit();default:return-1}},getErrorMessage:function(){var e=this.getErrorString();switch(this.getError()){case Torrent._ErrTrackerWarning:return"Tracker返回了一个警告: "+e;case Torrent._ErrTrackerError:return"Tracker返回了一个错误: "+e;case Torrent._ErrLocalError:return"错误: "+e;default:return null}},getCollatedName:function(){var e=this.fields;return!e.collatedName&&e.name&&(e.collatedName=e.name.toLowerCase()),e.collatedName||""},getCollatedTrackers:function(){var e=this.fields;return!e.collatedTrackers&&e.trackers&&(e.collatedTrackers=this.collateTrackers(e.trackers)),e.collatedTrackers||""},testState:function(e){var t=this.getStatus();switch(e){case Prefs._FilterActive:return this.getPeersGettingFromUs()>0||this.getPeersSendingToUs()>0||this.getWebseedsSendingToUs()>0||this.isChecking();case Prefs._FilterSeeding:return t===Torrent._StatusSeed||t===Torrent._StatusSeedWait;case Prefs._FilterDownloading:return t===Torrent._StatusDownload||t===Torrent._StatusDownloadWait;case Prefs._FilterPaused:return this.isStopped();case Prefs._FilterFinished:return this.isFinished();default:return!0}},test:function(e,t,r){var n=this.testState(e);return n&&t&&t.length&&(n=this.getCollatedName().indexOf(t.toLowerCase())!==-1),n&&r&&r.length&&(n=this.getCollatedTrackers().indexOf(r)!==-1),n}},Torrent.compareById=function(e,t){return e.getId()-t.getId()},Torrent.compareByName=function(e,t){return e.getCollatedName().localeCompare(t.getCollatedName())||Torrent.compareById(e,t)},Torrent.compareByQueue=function(e,t){return e.getQueuePosition()-t.getQueuePosition()},Torrent.compareByAge=function(e,t){var r=e.getDateAdded(),n=t.getDateAdded();return n-r||Torrent.compareByQueue(e,t)},Torrent.compareByState=function(e,t){var r=e.getStatus(),n=t.getStatus();return n-r||Torrent.compareByQueue(e,t)},Torrent.compareByActivity=function(e,t){var r=e.getActivity(),n=t.getActivity();return n-r||Torrent.compareByState(e,t)},Torrent.compareByRatio=function(e,t){var r=e.getUploadRatio(),n=t.getUploadRatio();return r<n?1:r>n?-1:Torrent.compareByState(e,t)},Torrent.compareByProgress=function(e,t){var r=e.getPercentDone(),n=t.getPercentDone();return r-n||Torrent.compareByRatio(e,t)},Torrent.compareBySize=function(e,t){var r=e.getTotalSize(),n=t.getTotalSize();return r-n||Torrent.compareByName(e,t)},Torrent.compareTorrents=function(e,t,r,n){var i;switch(r){case Prefs._SortByActivity:i=Torrent.compareByActivity(e,t);break;case Prefs._SortByAge:
i=Torrent.compareByAge(e,t);break;case Prefs._SortByQueue:i=Torrent.compareByQueue(e,t);break;case Prefs._SortByProgress:i=Torrent.compareByProgress(e,t);break;case Prefs._SortBySize:i=Torrent.compareBySize(e,t);break;case Prefs._SortByState:i=Torrent.compareByState(e,t);break;case Prefs._SortByRatio:i=Torrent.compareByRatio(e,t);break;default:i=Torrent.compareByName(e,t)}return n===Prefs._SortDescending&&(i=-i),i},Torrent.sortTorrents=function(e,t,r){switch(t){case Prefs._SortByActivity:e.sort(this.compareByActivity);break;case Prefs._SortByAge:e.sort(this.compareByAge);break;case Prefs._SortByQueue:e.sort(this.compareByQueue);break;case Prefs._SortByProgress:e.sort(this.compareByProgress);break;case Prefs._SortBySize:e.sort(this.compareBySize);break;case Prefs._SortByState:e.sort(this.compareByState);break;case Prefs._SortByRatio:e.sort(this.compareByRatio);break;default:e.sort(this.compareByName)}return r===Prefs._SortDescending&&e.reverse(),e},TorrentRendererHelper.getProgressInfo=function(e,t){var r,n,i=t.getStatus(),o=t.seedRatioLimit(e);return r=t.needsMetaData()?100*t.getMetadataPercentComplete():t.isDone()?o>0&&t.isSeeding()?Math.round(100*t.getUploadRatio()/o):100:Math.round(100*t.getPercentDone()),n=i===Torrent._StatusStopped?"paused":i===Torrent._StatusDownloadWait?"leeching queued":t.needsMetaData()?"magnet":i===Torrent._StatusDownload?"leeching":i===Torrent._StatusSeedWait?"seeding queued":i===Torrent._StatusSeed?"seeding":"",{percent:r,complete:["torrent_progress_bar","complete",n].join(" "),incomplete:["torrent_progress_bar","incomplete",n].join(" ")}},TorrentRendererHelper.createProgressbar=function(e){var t,r,n;return t=document.createElement("div"),t.className="torrent_progress_bar complete",r=document.createElement("div"),r.className="torrent_progress_bar incomplete",n=document.createElement("div"),n.className="torrent_progress_bar_container "+e,n.appendChild(t),n.appendChild(r),{element:n,complete:t,incomplete:r}},TorrentRendererHelper.renderProgressbar=function(e,t,r){var n,i,o,s,a=TorrentRendererHelper.getProgressInfo(e,t);n=r.complete,i=n.style,o=""+a.percent+"%",s=a.percent>0?"block":"none",i.width===o&&i.display===s||$(n).css({width:""+a.percent+"%",display:s}),n.className!==a.complete&&(n.className=a.complete),n=r.incomplete,s=a.percent<100?"block":"none",n.style.display!==s&&(n.style.display=s),n.className!==a.incomplete&&(n.className=a.incomplete)},TorrentRendererHelper.formatUL=function(e){return"↑ "+Transmission.fmt.speedBps(e.getUploadSpeed())},TorrentRendererHelper.formatDL=function(e){return"↓ "+Transmission.fmt.speedBps(e.getDownloadSpeed())},TorrentRendererFull.prototype={createRow:function(){var e,t,r,n,i,o,s;return e=document.createElement("li"),e.className="torrent",t=document.createElement("div"),t.className="torrent_name",r=document.createElement("div"),r.className="torrent_peer_details",n=TorrentRendererHelper.createProgressbar("full"),i=document.createElement("div"),i.className="torrent_progress_details",o=document.createElement("div"),s=document.createElement("a"),s.appendChild(o),e.appendChild(t),e.appendChild(r),e.appendChild(s),e.appendChild(n.element),e.appendChild(i),e._name_container=t,e._peer_details_container=r,e._progress_details_container=i,e._progressbar=n,e._pause_resume_button_image=o,e._toggle_running_button=s,e},getPeerDetails:function(e){var t,r,n,i=Transmission.fmt;return(t=e.getErrorMessage())?t:e.isDownloading()?(r=e.getPeersConnected(),n=e.getWebseedsSendingToUs(),n&&r?["下载自",e.getPeersSendingToUs(),"of",i.countString("peer","peers",r),"and",i.countString("web seed","web seeds",n),"-",TorrentRendererHelper.formatDL(e),TorrentRendererHelper.formatUL(e)].join(" "):n?["下载自",i.countString("web seed","web seeds",n),"-",TorrentRendererHelper.formatDL(e),TorrentRendererHelper.formatUL(e)].join(" "):["下载自",e.getPeersSendingToUs(),"of",i.countString("peer","peers",r),"-",TorrentRendererHelper.formatDL(e),TorrentRendererHelper.formatUL(e)].join(" ")):e.isSeeding()?["做种至",e.getPeersGettingFromUs(),"of",i.countString("peer","peers",e.getPeersConnected()),"-",TorrentRendererHelper.formatUL(e)].join(" "):e.isChecking()?["正在验证本地数据 (",Transmission.fmt.percentString(100*e.getRecheckProgress()),"% 已验证)"].join(""):e.getStateString()},getProgressDetails:function(e,t){if(t.needsMetaData()){var r="检索";t.isStopped()&&(r="需要");var n=100*t.getMetadataPercentComplete();return["磁性传输 - "+r+" 元数据 (",Transmission.fmt.percentString(n),"%)"].join("")}var i,o=t.getSizeWhenDone(),s=t.getTotalSize(),a=t.isDone()||t.isSeeding();if(a?(i=s===o?[Transmission.fmt.size(s)]:[Transmission.fmt.size(o)," of ",Transmission.fmt.size(t.getTotalSize())," (",t.getPercentDoneStr(),"%)"],i.push(", 已上传 ",Transmission.fmt.size(t.getUploadedEver())," (分享率 ",Transmission.fmt.ratioString(t.getUploadRatio()),")")):i=[Transmission.fmt.size(o-t.getLeftUntilDone())," of ",Transmission.fmt.size(o)," (",t.getPercentDoneStr(),"%)"],!t.isStopped()&&(!a||t.seedRatioLimit(e)>0)){i.push(" - ");var l=t.getETA();l<0||l>=3596400?i.push("未知剩余时间"):i.push("剩余时间 ",Transmission.fmt.timeInterval(t.getETA()))}return i.join("")},render:function(e,t,r){setTextContent(r._name_container,t.getName()),TorrentRendererHelper.renderProgressbar(e,t,r._progressbar);var n=t.getError()!==Torrent._ErrNone,i=r._peer_details_container;$(i).toggleClass("error",n),setTextContent(i,this.getPeerDetails(t)),i=r._progress_details_container,setTextContent(i,this.getProgressDetails(e,t));var o=t.isStopped();i=r._pause_resume_button_image,i.alt=o?"Resume":"Pause",i.className=o?"torrent_resume icon-start-deep":"torrent_pause icon-pause-deep"}},TorrentRendererCompact.prototype={createRow:function(){var e,t,r,n;return e=TorrentRendererHelper.createProgressbar("compact"),t=document.createElement("div"),t.className="torrent_peer_details compact",r=document.createElement("div"),r.className="torrent_name compact",n=document.createElement("li"),n.appendChild(e.element),n.appendChild(t),n.appendChild(r),n.className="torrent compact",n._progressbar=e,n._details_container=t,n._name_container=r,n},getPeerDetails:function(e){var t;if(t=e.getErrorMessage())return t;if(e.isDownloading()){var r=e.getDownloadSpeed()>0,n=e.getUploadSpeed()>0;if(!n&&!r)return"Idle";var i="";return r&&(i+=TorrentRendererHelper.formatDL(e)),r&&n&&(i+=" "),n&&(i+=TorrentRendererHelper.formatUL(e)),i}return e.isSeeding()?["分享率: ",Transmission.fmt.ratioString(e.getUploadRatio()),", ",TorrentRendererHelper.formatUL(e)].join(""):e.getStateString()},render:function(e,t,r){var n=t.isStopped(),i=r._name_container;$(i).toggleClass("paused",n),setTextContent(i,t.getName());var o=t.getError()!==Torrent._ErrNone;i=r._details_container,$(i).toggleClass("error",o),setTextContent(i,this.getPeerDetails(t)),TorrentRendererHelper.renderProgressbar(e,t,r._progressbar)}},TorrentRow.prototype={initialize:function(e,t,r){var n=this;this._view=e,this._torrent=r,this._element=e.createRow(),this.render(t),$(this._torrent).bind("dataChanged.torrentRowListener",function(){n.render(t)})},getElement:function(){return this._element},render:function(e){var t=this.getTorrent();t&&this._view.render(e,t,this.getElement())},isSelected:function(){return this.getElement().className.indexOf("selected")!==-1},getTorrent:function(){return this._torrent},getTorrentId:function(){return this.getTorrent().getId()}},Dialog.prototype={initialize:function(){this._container=$("#dialog_container"),this._heading=$("#dialog_heading"),this._message=$("#dialog_message"),this._cancel_button=$("#dialog_cancel_button"),this._confirm_button=$("#dialog_confirm_button"),this._callback=null,this._cancel_button.bind("click",{dialog:this},this.onCancelClicked),this._confirm_button.bind("click",{dialog:this},this.onConfirmClicked)},hideDialog:function(){$("body.dialog_showing").removeClass("dialog_showing"),this._container.hide(),transmission.hideMobileAddressbar(),transmission.updateButtonStates()},onCancelClicked:function(e){e.data.dialog.hideDialog()},onConfirmClicked:function(e){var t=e.data.dialog;t._callback(),t.hideDialog()},confirm:function(e,t,r,n,i){isMobileDevice||$(".dialog_container").hide(),setTextContent(this._heading[0],e),setTextContent(this._message[0],t),setTextContent(this._cancel_button[0],i||"取消"),setTextContent(this._confirm_button[0],r),this._confirm_button.show(),this._callback=n,$("body").addClass("dialog_showing"),this._container.show(),transmission.updateButtonStates(),isMobileDevice&&transmission.hideMobileAddressbar()},alert:function(e,t,r){isMobileDevice||$(".dialog_container").hide(),setTextContent(this._heading[0],e),setTextContent(this._message[0],t),this._confirm_button.css("display","none"),setTextContent(this._cancel_button[0],r),$("#upload_container").hide(),$("#move_container").hide(),$("body").addClass("dialog_showing"),transmission.updateButtonStates(),isMobileDevice&&transmission.hideMobileAddressbar(),this._container.show()}},Transmission.fmt=function(){var e=1e3,t="kB/s",r="MB/s",n="GB/s",i=1e3,o="B",s="kB",a="MB",l="GB",d="TB",c=1024,u="B",h="KiB",f="MiB",p="GiB",m="TiB";return{updateUnits:function(e){},percentString:function(e){return e<10?e.toTruncFixed(2):e<100?e.toTruncFixed(1):e.toTruncFixed(0)},ratioString:function(e){return e===-1?"None":e===-2?"&infin;":this.percentString(e)},mem:function(e){if(e<c)return[e,u].join(" ");var t,r;return e<Math.pow(c,2)?(t=e/c,r=h):e<Math.pow(c,3)?(t=e/Math.pow(c,2),r=f):e<Math.pow(c,4)?(t=e/Math.pow(c,3),r=p):(t=e/Math.pow(c,4),r=m),t<=9.995?[t.toTruncFixed(2),r].join(" "):[t.toTruncFixed(1),r].join(" ")},size:function(e){if(e<i)return[e,o].join(" ");var t,r;return e<Math.pow(i,2)?(t=e/i,r=s):e<Math.pow(i,3)?(t=e/Math.pow(i,2),r=a):e<Math.pow(i,4)?(t=e/Math.pow(i,3),r=l):(t=e/Math.pow(i,4),r=d),t<=9.995?[t.toTruncFixed(2),r].join(" "):[t.toTruncFixed(1),r].join(" ")},speedBps:function(e){return this.speed(this.toKBps(e))},toKBps:function(t){return Math.floor(t/e)},speed:function(i){var o=i;return o<=999.95?[o.toTruncFixed(0),t].join(" "):(o/=e,o<=99.995?[o.toTruncFixed(2),r].join(" "):o<=999.95?[o.toTruncFixed(1),r].join(" "):(o/=e,[o.toTruncFixed(2),n].join(" ")))},timeInterval:function(e){var t=Math.floor(e/86400),r=Math.floor(e%86400/3600),n=Math.floor(e%3600/60),e=Math.floor(e%60),i=t+" 天",o=r+" 小时",s=n+" 分钟",a=e+" 秒";return t?t>=4||!r?i:i+", "+o:r?r>=4||!n?o:o+", "+s:n?n>=4||!e?s:s+", "+a:a},timestamp:function(e){if(!e)return"N/A";var t=new Date(1e3*e),r=new Date,n="",i="",o=r.getFullYear()===t.getFullYear(),s=r.getMonth()===t.getMonth(),a=r.getDate()-t.getDate();n=o&&s&&Math.abs(a)<=1?0===a?"Today":1===a?"Yesterday":"Tomorrow":t.toDateString();var l=t.getHours(),d="AM";l>12&&(l-=12,d="PM"),0===l&&(l=12),l<10&&(l="0"+l);var c=t.getMinutes();c<10&&(c="0"+c);var e=t.getSeconds();return e<10&&(e="0"+e),i=[l,c,e].join(":"),[n,i,d].join(" ")},ngettext:function(e,t,r){return 1===r?e:t},countString:function(e,t,r){return[r.toStringWithCommas(),this.ngettext(e,t,r)].join(" ")},peerStatus:function(e){for(var t,r=[],n=0;t=e[n];++n){var i=null;switch(t){case"O":i="Optimistic unchoke";break;case"D":i="Downloading from this peer";break;case"d":i="We would download from this peer if they'd let us";break;case"U":i="Uploading to peer";break;case"u":i="We would upload to this peer if they'd ask";break;case"K":i="Peer has unchoked us, but we're not interested";break;case"?":i="We unchoked this peer, but they're not interested";break;case"E":i="Encrypted Connection";break;case"H":i="Peer was discovered through Distributed Hash Table (DHT)";break;case"X":i="Peer was discovered through Peer Exchange (PEX)";break;case"I":i="Peer is an incoming connection";break;case"T":i="Peer is connected via uTP"}i?r.push('<span title="'+t+": "+i+'">'+t+"</span>"):r.push(t)}return r.join("")}}}();var Notifications={};$(document).ready(function(){function e(){r.html((t?"Disable":"Enable")+" Notifications")}if(window.webkitNotifications){var t=0===window.webkitNotifications.checkPermission(),r=$("#toggle_notifications");r.show(),e(),$(transmission).bind("downloadComplete seedingComplete",function(e,r){if(t){var n,i=("downloadComplete"==e.type?"Download":"Seeding")+" complete",o=r.getName();n=window.webkitNotifications.createNotification("style/transmission/images/logo.png",i,o),n.show(),setTimeout(function(){n.cancel()},5e3)}}),Notifications.toggle=function(){0!==window.webkitNotifications.checkPermission()?window.webkitNotifications.requestPermission(function(){t=0===window.webkitNotifications.checkPermission(),e()}):(t=!t,e())}}});