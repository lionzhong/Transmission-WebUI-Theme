function TransmissionRemote(e){return this.initialize(e),this}var RPC={_DaemonVersion:"version",_DownSpeedLimit:"speed-limit-down",_DownSpeedLimited:"speed-limit-down-enabled",_QueueMoveTop:"queue-move-top",_QueueMoveBottom:"queue-move-bottom",_QueueMoveUp:"queue-move-up",_QueueMoveDown:"queue-move-down",_Root:"../rpc",_TurtleDownSpeedLimit:"alt-speed-down",_TurtleState:"alt-speed-enabled",_TurtleUpSpeedLimit:"alt-speed-up",_UpSpeedLimit:"speed-limit-up",_UpSpeedLimited:"speed-limit-up-enabled"};TransmissionRemote.prototype={initialize:function(e){this._controller=e,this._error="",this._token=""},ajaxError:function(e,t,n,o){var s,r=this;return 409===e.status&&(s=e.getResponseHeader("X-Transmission-Session-Id"))?(r._token=s,void $.ajax(o)):(r._error=e.responseText?e.responseText.trim().replace(/(<([^>]+)>)/gi,""):"",r._error.length||(r._error="Server not responding"),dialog.confirm("设备连接失败","无法连接到设备. 请尝试刷新此页面来重载界面.","查看详情","alert(remote._error);",null,"关闭"),void r._controller.togglePeriodicSessionRefresh(!1))},appendSessionId:function(e){e.setRequestHeader("X-Transmission-Session-Id",this._token)},sendRequest:function(e,t,n,o){var s=this;"boolean"!=typeof o&&(o=!0);var r={url:RPC._Root,type:"POST",contentType:"json",dataType:"json",cache:!1,data:JSON.stringify(e),beforeSend:function(e){s.appendSessionId(e)},error:function(e,t,n){s.ajaxError(e,t,n,r)},success:t,context:n,async:o};$.ajax(r)},loadDaemonPrefs:function(e,t,n){var o={method:"session-get"};this.sendRequest(o,e,t,n)},checkPort:function(e,t,n){var o={method:"port-test"};this.sendRequest(o,e,t,n)},loadDaemonStats:function(e,t,n){var o={method:"session-stats"};this.sendRequest(o,e,t,n)},updateTorrents:function(e,t,n,o){var s={method:"torrent-get",arguments:{fields:t}};e&&(s.arguments.ids=e),this.sendRequest(s,function(e){var t=e.arguments;n.call(o,t.torrents,t.removed)})},changeFileCommand:function(e,t,n){var o=this,s={ids:[e]};s[n]=t,this.sendRequest({arguments:s,method:"torrent-set"},function(){o._controller.refreshTorrents([e])})},sendTorrentSetRequests:function(e,t,n,o,s){n||(n={}),n.ids=t;var r={method:e,arguments:n};this.sendRequest(r,o,s)},sendTorrentActionRequests:function(e,t,n,o){this.sendTorrentSetRequests(e,t,null,n,o)},startTorrents:function(e,t,n,o){var s=t?"torrent-start-now":"torrent-start";this.sendTorrentActionRequests(s,e,n,o)},stopTorrents:function(e,t,n){this.sendTorrentActionRequests("torrent-stop",e,t,n)},removeTorrents:function(e,t,n){this.sendTorrentActionRequests("torrent-remove",e,t,n)},removeTorrentsAndData:function(e){var t=this,n={method:"torrent-remove",arguments:{"delete-local-data":!0,ids:[]}};if(e)for(var o=0,s=e.length;o<s;++o)n.arguments.ids.push(e[o].getId());this.sendRequest(n,function(){t._controller.refreshTorrents()})},verifyTorrents:function(e,t,n){this.sendTorrentActionRequests("torrent-verify",e,t,n)},reannounceTorrents:function(e,t,n){this.sendTorrentActionRequests("torrent-reannounce",e,t,n)},addTorrentByUrl:function(e,t){var n=this;e.match(/^[0-9a-f]{40}$/i)&&(e="magnet:?xt=urn:btih:"+e);var o={method:"torrent-add",arguments:{paused:t.paused,filename:e}};this.sendRequest(o,function(){n._controller.refreshTorrents()})},savePrefs:function(e){var t=this,n={method:"session-set",arguments:e};this.sendRequest(n,function(){t._controller.loadDaemonPrefs()})},updateBlocklist:function(){var e=this,t={method:"blocklist-update"};this.sendRequest(t,function(){e._controller.loadDaemonPrefs()})},moveTorrentsToTop:function(e,t,n){this.sendTorrentActionRequests(RPC._QueueMoveTop,e,t,n)},moveTorrentsToBottom:function(e,t,n){this.sendTorrentActionRequests(RPC._QueueMoveBottom,e,t,n)},moveTorrentsUp:function(e,t,n){this.sendTorrentActionRequests(RPC._QueueMoveUp,e,t,n)},moveTorrentsDown:function(e,t,n){this.sendTorrentActionRequests(RPC._QueueMoveDown,e,t,n)}};