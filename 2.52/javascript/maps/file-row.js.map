{"version":3,"sources":["file-row.js"],"names":["FileRow","torrent","i","fields","have","index","isDirty","isWanted","priority","me","this","size","elements","priority_low_button","priority_normal_button","priority_high_button","progress","root","initialize","createRow","readAttributes","file","bytesCompleted","length","wanted","refreshWantedHTML","e","$","toggleClass","isDone","checkbox","prop","refreshPriorityHTML","refreshProgressHTML","pct","c","Transmission","fmt","percentString","join","setTextContent","refreshHTML","refresh","getFile","name","box","document","createElement","id","getId","className","type","title","change","ev","fireWantedChanged","currentTarget","appendChild","click","firePriorityChanged","substring","lastIndexOf","replace","do_want","trigger","getElement","getIndex","isEditable","getFileCount"],"mappings":"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","file":"file-row.js","sourcesContent":["/**\n * Copyright © Mnemosyne LLC\n *\n * This file is licensed under the GPLv2.\n * http://www.gnu.org/licenses/old-licenses/gpl-2.0.html\n */\n\nfunction FileRow(torrent, i)\n{\n\tvar fields = {\n\t\thave: 0,\n\t\tindex: 0,\n\t\tisDirty: false,\n\t\tisWanted: true,\n\t\tpriority: 0,\n\t\tme: this,\n\t\tsize: 0,\n\t\ttorrent: null\n\t},\n\n\telements = {\n\t\tpriority_low_button: null,\n\t\tpriority_normal_button: null,\n\t\tpriority_high_button: null,\n\t\tprogress: null,\n\t\troot: null\n\t},\n\n\tinitialize = function(torrent, i) {\n\t\tfields.torrent = torrent;\n\t\tfields.index = i;\n\t\tcreateRow(torrent, i);\n\t},\n\n\treadAttributes = function(file) {\n\t\tif (fields.have !== file.bytesCompleted) {\n\t\t\tfields.have = file.bytesCompleted;\n\t\t\tfields.isDirty = true;\n\t\t}\n\t\tif (fields.size !== file.length) {\n\t\t\tfields.size = file.length;\n\t\t\tfields.isDirty = true;\n\t\t}\n\t\tif (fields.priority !== file.priority) {\n\t\t\tfields.priority = file.priority;\n\t\t\tfields.isDirty = true;\n\t\t}\n\t\tif (fields.isWanted !== file.wanted) {\n\t\t\tfields.isWanted = file.wanted;\n\t\t\tfields.isDirty = true;\n\t\t}\n\t},\n\n\trefreshWantedHTML = function()\n\t{\n\t\tvar e = $(elements.root);\n\t\te.toggleClass('skip', !fields.isWanted);\n\t\te.toggleClass('complete', isDone());\n\t\t$(e[0].checkbox).prop('checked', fields.isWanted);\n\t},\n\trefreshPriorityHTML = function()\n\t{\n\t\t$(elements.priority_high_button  ).toggleClass('selected', fields.priority ===  1 );\n\t\t$(elements.priority_normal_button).toggleClass('selected', fields.priority ===  0 );\n\t\t$(elements.priority_low_button   ).toggleClass('selected', fields.priority === -1 );\n\t},\n\trefreshProgressHTML = function()\n\t{\n\t\tvar pct = 100 * (fields.size ? (fields.have / fields.size) : 1.0),\n\t\t    c = [ Transmission.fmt.size(fields.have),\n\t\t\t  ' of ',\n\t\t\t  Transmission.fmt.size(fields.size),\n\t\t\t  ' (',\n\t\t\t  Transmission.fmt.percentString(pct),\n\t\t\t  '%)' ].join('');\n\t\tsetTextContent(elements.progress, c);\n\t},\n\trefreshHTML = function() {\n\t\tif (fields.isDirty) {\n\t\t\tfields.isDirty = false;\n\t\t\trefreshProgressHTML();\n\t\t\trefreshWantedHTML();\n\t\t\trefreshPriorityHTML();\n\t\t}\n\t},\n\trefresh = function() {\n\t\treadAttributes(fields.torrent.getFile(fields.index));\n\t\trefreshHTML();\n\t},\n\n\tisDone = function () {\n\t\treturn fields.have >= fields.size;\n\t},\n\n\tcreateRow = function(torrent, i) {\n\t\tvar file = torrent.getFile(i), e, name, root, box;\n\n\t\troot = document.createElement('li');\n\t\troot.id = 't' + fields.torrent.getId() + 'f' + fields.index;\n\t\troot.className = 'inspector_torrent_file_list_entry ' + ((i%2)?'odd':'even');\n\t\telements.root = root;\n\n\t\te = document.createElement('input');\n\t\te.type = 'checkbox';\n\t\te.className = \"file_wanted_control\";\n\t\te.title = 'Download file';\n\t\t$(e).change(function(ev){ fireWantedChanged( $(ev.currentTarget).prop('checked')); });\n\t\troot.checkbox = e;\n\t\troot.appendChild(e);\n\n\t\te = document.createElement('div');\n\t\te.className = 'file-priority-radiobox';\n\t\tbox = e;\n\n\t\t\te = document.createElement('div');\n\t\t\te.className = 'low';\n\t\t\te.title = '低优先级';\n\t\t\t$(e).click(function(){ firePriorityChanged(-1); });\n\t\t\telements.priority_low_button = e;\n\t\t\tbox.appendChild(e);\n\n\t\t\te = document.createElement('div');\n\t\t\te.className = 'normal';\n\t\t\te.title = '标准优先级';\n\t\t\t$(e).click(function(){ firePriorityChanged(0); });\n\t\t\telements.priority_normal_button = e;\n\t\t\tbox.appendChild(e);\n\n\t\t\te = document.createElement('div');\n\t\t\te.title = '低优先级';\n\t\t\te.className = 'high';\n\t\t\t$(e).click(function(){ firePriorityChanged(1); });\n\t\t\telements.priority_high_button = e;\n\t\t\tbox.appendChild(e);\n\n\t\troot.appendChild(box);\n\n\t\tname = file.name || 'Unknown';\n\t\tname = name.substring(name.lastIndexOf('/')+1);\n\t\tname = name.replace(/([\\/_\\.])/g, \"$1&#8203;\");\n\t\te = document.createElement('div');\n\t\te.className = \"inspector_torrent_file_list_entry_name\";\n\t\tsetTextContent(e, name);\n\t\troot.appendChild(e);\n\n\t\te = document.createElement('div');\n\t\te.className = \"inspector_torrent_file_list_entry_progress\";\n\t\troot.appendChild(e);\n\t\telements.progress = e;\n\n\t\trefresh();\n\t\treturn root;\n\t},\n\n\tfireWantedChanged = function(do_want) {\n\t\t$(fields.me).trigger('wantedToggled',[ fields.me, do_want ]);\n\t},\n\tfirePriorityChanged = function(priority) {\n\t\t$(fields.me).trigger('priorityToggled',[ fields.me, priority ]);\n\t};\n\n\t/***\n\t****  PUBLIC\n\t***/\n\n\tthis.getElement = function() {\n\t\treturn elements.root;\n\t};\n\tthis.getIndex = function() {\n\t\treturn fields.index;\n\t};\n\tthis.isEditable = function () {\n\t\treturn (fields.torrent.getFileCount()>1) && !isDone();\n\t};\n\n\tinitialize(torrent, i);\n};\n"],"sourceRoot":"/source/"}