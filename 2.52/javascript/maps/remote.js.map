{"version":3,"sources":["remote.js"],"names":["TransmissionRemote","controller","this","initialize","RPC","_DaemonVersion","_DownSpeedLimit","_DownSpeedLimited","_QueueMoveTop","_QueueMoveBottom","_QueueMoveUp","_QueueMoveDown","_Root","_TurtleDownSpeedLimit","_TurtleState","_TurtleUpSpeedLimit","_UpSpeedLimit","_UpSpeedLimited","prototype","_controller","_error","_token","ajaxError","request","error_string","exception","ajaxObject","token","remote","status","getResponseHeader","$","ajax","responseText","trim","replace","length","dialog","confirm","togglePeriodicSessionRefresh","appendSessionId","XHR","setRequestHeader","sendRequest","data","callback","context","async","ajaxSettings","url","type","contentType","dataType","cache","JSON","stringify","beforeSend","error","success","loadDaemonPrefs","o","method","checkPort","loadDaemonStats","updateTorrents","torrentIds","fields","arguments","ids","response","args","call","torrents","removed","changeFileCommand","torrentId","fileIndices","command","refreshTorrents","sendTorrentSetRequests","torrent_ids","sendTorrentActionRequests","startTorrents","noqueue","name","stopTorrents","removeTorrents","removeTorrentsAndData","delete-local-data","i","len","push","getId","verifyTorrents","reannounceTorrents","addTorrentByUrl","options","match","paused","filename","savePrefs","updateBlocklist","moveTorrentsToTop","moveTorrentsToBottom","moveTorrentsUp","moveTorrentsDown"],"mappings":"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","file":"remote.js","sourcesContent":["/**\n * Copyright © Jordan Lee, Dave Perrett, Malcolm Jarvis and Bruno Bierbaumer\n *\n * This file is licensed under the GPLv2.\n * http://www.gnu.org/licenses/old-licenses/gpl-2.0.html\n */\n\nvar RPC = {\n\t_DaemonVersion          : 'version',\n\t_DownSpeedLimit         : 'speed-limit-down',\n\t_DownSpeedLimited       : 'speed-limit-down-enabled',\n\t_QueueMoveTop           : 'queue-move-top',\n\t_QueueMoveBottom        : 'queue-move-bottom',\n\t_QueueMoveUp            : 'queue-move-up',\n\t_QueueMoveDown          : 'queue-move-down',\n\t_Root                   : '../rpc',\n\t_TurtleDownSpeedLimit   : 'alt-speed-down',\n\t_TurtleState            : 'alt-speed-enabled',\n\t_TurtleUpSpeedLimit     : 'alt-speed-up',\n\t_UpSpeedLimit           : 'speed-limit-up',\n\t_UpSpeedLimited         : 'speed-limit-up-enabled'\n};\n\nfunction TransmissionRemote(controller)\n{\n\tthis.initialize(controller);\n\treturn this;\n}\n\nTransmissionRemote.prototype =\n{\n\t/*\n\t * Constructor\n\t */\n\tinitialize: function(controller) {\n\t\tthis._controller = controller;\n\t\tthis._error = '';\n\t\tthis._token = '';\n\t},\n\n\t/*\n\t * Display an error if an ajax request fails, and stop sending requests\n\t * or on a 409, globally set the X-Transmission-Session-Id and resend\n\t */\n\tajaxError: function(request, error_string, exception, ajaxObject) {\n\t\tvar token,\n\t\t   remote = this;\n\n\t\t// set the Transmission-Session-Id on a 409\n\t\tif (request.status === 409 && (token = request.getResponseHeader('X-Transmission-Session-Id'))){\n\t\t\tremote._token = token;\n\t\t\t$.ajax(ajaxObject);\n\t\t\treturn;\n\t\t}\n\n\t\tremote._error = request.responseText\n\t\t\t\t\t? request.responseText.trim().replace(/(<([^>]+)>)/ig,\"\")\n\t\t\t\t\t: \"\";\n\t\tif (!remote._error.length)\n\t\t\tremote._error = 'Server not responding';\n\n\t\tdialog.confirm('设备连接失败',\n\t\t\t'无法连接到设备. 请尝试刷新此页面来重载界面.',\n\t\t\t'查看详情',\n\t\t\t'alert(remote._error);',\n\t\t\tnull,\n\t\t\t'关闭');\n\t\tremote._controller.togglePeriodicSessionRefresh(false);\n\t},\n\n\tappendSessionId: function(XHR) {\n\t\tXHR.setRequestHeader('X-Transmission-Session-Id', this._token);\n\t},\n\n\tsendRequest: function(data, callback, context, async) {\n\t\tvar remote = this;\n\t\tif (typeof async != 'boolean')\n\t\t\tasync = true;\n\n\t\tvar ajaxSettings = {\n\t\t\turl: RPC._Root,\n\t\t\ttype: 'POST',\n\t\t\tcontentType: 'json',\n\t\t\tdataType: 'json',\n\t\t\tcache: false,\n\t\t\tdata: JSON.stringify(data),\n\t\t\tbeforeSend: function(XHR){ remote.appendSessionId(XHR); },\n\t\t\terror: function(request, error_string, exception){ remote.ajaxError(request, error_string, exception, ajaxSettings); },\n\t\t\tsuccess: callback,\n\t\t\tcontext: context,\n\t\t\tasync: async\n\t\t};\n\n\t\t$.ajax(ajaxSettings);\n\t},\n\n\tloadDaemonPrefs: function(callback, context, async) {\n\t\tvar o = { method: 'session-get' };\n\t\tthis.sendRequest(o, callback, context, async);\n\t},\n\t\n\tcheckPort: function(callback, context, async) {\n\t\tvar o = { method: 'port-test' };\n\t\tthis.sendRequest(o, callback, context, async);\n\t},\n\t\n\tloadDaemonStats: function(callback, context, async) {\n\t\tvar o = { method: 'session-stats' };\n\t\tthis.sendRequest(o, callback, context, async);\n\t},\n\n\tupdateTorrents: function(torrentIds, fields, callback, context) {\n\t\tvar o = {\n\t\t\tmethod: 'torrent-get',\n\t\t\t\t'arguments': {\n\t\t\t\t'fields': fields\n\t\t\t}\n\t\t};\n\t\tif (torrentIds)\n\t\t\to['arguments'].ids = torrentIds;\n\t\tthis.sendRequest(o, function(response) {\n\t\t\tvar args = response['arguments'];\n\t\t\tcallback.call(context,args.torrents,args.removed);\n\t\t});\n\t},\n\n\tchangeFileCommand: function(torrentId, fileIndices, command) {\n\t\tvar remote = this,\n\t\t    args = { ids: [torrentId] };\n\t\targs[command] = fileIndices;\n\t\tthis.sendRequest({\n\t\t\targuments: args,\n\t\t\tmethod: 'torrent-set'\n\t\t}, function() {\n\t\t\tremote._controller.refreshTorrents([torrentId]);\n\t\t});\n\t},\n\n\tsendTorrentSetRequests: function(method, torrent_ids, args, callback, context) {\n\t\tif (!args) args = { };\n\t\targs['ids'] = torrent_ids;\n\t\tvar o = {\n\t\t\tmethod: method,\n\t\t\targuments: args\n\t\t};\n\t\tthis.sendRequest(o, callback, context);\n\t},\n\n\tsendTorrentActionRequests: function(method, torrent_ids, callback, context) {\n\t\tthis.sendTorrentSetRequests(method, torrent_ids, null, callback, context);\n\t},\n\n\tstartTorrents: function(torrent_ids, noqueue, callback, context) {\n\t\tvar name = noqueue ? 'torrent-start-now' : 'torrent-start';\n\t\tthis.sendTorrentActionRequests(name, torrent_ids, callback, context);\n\t},\n\tstopTorrents: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests('torrent-stop', torrent_ids, callback, context);\n\t},\n\tremoveTorrents: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests('torrent-remove', torrent_ids, callback, context);\n\t},\n\tremoveTorrentsAndData: function(torrents) {\n\t\tvar remote = this;\n\t\tvar o = {\n\t\t\tmethod: 'torrent-remove',\n\t\t\targuments: {\n\t\t\t\t'delete-local-data': true,\n\t\t\t\tids: [ ]\n\t\t\t}\n\t\t};\n\n\t\tif (torrents) {\n\t\t\tfor (var i=0, len=torrents.length; i<len; ++i) {\n\t\t\t\to.arguments.ids.push(torrents[i].getId());\n\t\t\t}\n\t\t}\n\t\tthis.sendRequest(o, function() {\n\t\t\tremote._controller.refreshTorrents();\n\t\t});\n\t},\n\tverifyTorrents: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests('torrent-verify', torrent_ids, callback, context);\n\t},\n\treannounceTorrents: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests('torrent-reannounce', torrent_ids, callback, context);\n\t},\n\taddTorrentByUrl: function(url, options) {\n\t\tvar remote = this;\n\t\tif (url.match(/^[0-9a-f]{40}$/i)) {\n\t\t\turl = 'magnet:?xt=urn:btih:'+url;\n\t\t}\n\t\tvar o = {\n\t\t\tmethod: 'torrent-add',\n\t\t\targuments: {\n\t\t\t\tpaused: (options.paused),\n\t\t\t\tfilename: url\n\t\t\t}\n\t\t};\n\t\tthis.sendRequest(o, function() {\n\t\t\tremote._controller.refreshTorrents();\n\t\t});\n\t},\n\tsavePrefs: function(args) {\n\t\tvar remote = this;\n\t\tvar o = {\n\t\t\tmethod: 'session-set',\n\t\t\targuments: args\n\t\t};\n\t\tthis.sendRequest(o, function() {\n\t\t\tremote._controller.loadDaemonPrefs();\n\t\t});\n\t},\n\tupdateBlocklist: function() {\n\t\tvar remote = this;\n\t\tvar o = {\n\t\t\tmethod: 'blocklist-update'\n\t\t};\n\t\tthis.sendRequest(o, function() {\n\t\t\tremote._controller.loadDaemonPrefs();\n\t\t});\n\t},\n\n\t// Added queue calls\n\tmoveTorrentsToTop: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests(RPC._QueueMoveTop, torrent_ids, callback, context);\n\t},\n\tmoveTorrentsToBottom: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests(RPC._QueueMoveBottom, torrent_ids, callback, context);\n\t},\n\tmoveTorrentsUp: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests(RPC._QueueMoveUp, torrent_ids, callback, context);\n\t},\n\tmoveTorrentsDown: function(torrent_ids, callback, context) {\n\t\tthis.sendTorrentActionRequests(RPC._QueueMoveDown, torrent_ids, callback, context);\n\t}\n};\n"],"sourceRoot":"/source/"}