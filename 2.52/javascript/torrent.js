function Torrent(e){this.initialize(e)}Torrent._StatusStopped=0,Torrent._StatusCheckWait=1,Torrent._StatusCheck=2,Torrent._StatusDownloadWait=3,Torrent._StatusDownload=4,Torrent._StatusSeedWait=5,Torrent._StatusSeed=6,Torrent._RatioUseGlobal=0,Torrent._RatioUseLocal=1,Torrent._RatioUnlimited=2,Torrent._ErrNone=0,Torrent._ErrTrackerWarning=1,Torrent._ErrTrackerError=2,Torrent._ErrLocalError=3,Torrent._TrackerInactive=0,Torrent._TrackerWaiting=1,Torrent._TrackerQueued=2,Torrent._TrackerActive=3,Torrent.Fields={},Torrent.Fields.Metadata=["addedDate","name","totalSize"],Torrent.Fields.Stats=["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","uploadedEver","uploadRatio"],Torrent.Fields.InfoExtra=["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"],Torrent.Fields.StatsExtra=["activityDate","corruptEver","desiredAvailable","downloadDir","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats","webseedsSendingToUs"],Torrent.prototype={initialize:function(e){this.fields={},this.refresh(e)},setField:function(e,t,r){return e[t]!==r&&(e[t]=r,!0)},updateFiles:function(e){var t,r,n,i,s,o=!1,a=this.fields.files||[],c=["length","name","bytesCompleted","wanted","priority"];for(t=0;r=e[t];++t){for(s=a[t]||{},n=0;i=c[n];++n)i in r&&(o|=this.setField(s,i,r[i]));a[t]=s}return this.fields.files=a,o},collateTrackers:function(e){var t,r,n=[];for(t=0;r=e[t];++t)n.push(r.announce.toLowerCase());return n.join("\t")},refreshFields:function(e){var t,r=!1;for(t in e)switch(t){case"files":case"fileStats":r|=this.updateFiles(e[t]);break;case"trackerStats":r|=this.setField(this.fields,"trackers",e[t]);break;case"trackers":t in this.fields||(r|=this.setField(this.fields,t,e[t]));break;default:r|=this.setField(this.fields,t,e[t])}return r},refresh:function(e){this.refreshFields(e)&&$(this).trigger("dataChanged",this)},getComment:function(){return this.fields.comment},getCreator:function(){return this.fields.creator},getDateAdded:function(){return this.fields.addedDate},getDateCreated:function(){return this.fields.dateCreated},getDesiredAvailable:function(){return this.fields.desiredAvailable},getDownloadDir:function(){return this.fields.downloadDir},getDownloadSpeed:function(){return this.fields.rateDownload},getDownloadedEver:function(){return this.fields.downloadedEver},getError:function(){return this.fields.error},getErrorString:function(){return this.fields.errorString},getETA:function(){return this.fields.eta},getFailedEver:function(e){return this.fields.corruptEver},getFile:function(e){return this.fields.files[e]},getFileCount:function(){return this.fields.files?this.fields.files.length:0},getHashString:function(){return this.fields.hashString},getHave:function(){return this.getHaveValid()+this.getHaveUnchecked()},getHaveUnchecked:function(){return this.fields.haveUnchecked},getHaveValid:function(){return this.fields.haveValid},getId:function(){return this.fields.id},getLastActivity:function(){return this.fields.activityDate},getLeftUntilDone:function(){return this.fields.leftUntilDone},getMetadataPercentComplete:function(){return this.fields.metadataPercentComplete},getName:function(){return this.fields.name||"Unknown"},getPeers:function(){return this.fields.peers},getPeersConnected:function(){return this.fields.peersConnected},getPeersGettingFromUs:function(){return this.fields.peersGettingFromUs},getPeersSendingToUs:function(){return this.fields.peersSendingToUs},getPieceCount:function(){return this.fields.pieceCount},getPieceSize:function(){return this.fields.pieceSize},getPrivateFlag:function(){return this.fields.isPrivate},getQueuePosition:function(){return this.fields.queuePosition},getRecheckProgress:function(){return this.fields.recheckProgress},getSeedRatioLimit:function(){return this.fields.seedRatioLimit},getSeedRatioMode:function(){return this.fields.seedRatioMode},getSizeWhenDone:function(){return this.fields.sizeWhenDone},getStartDate:function(){return this.fields.startDate},getStatus:function(){return this.fields.status},getTotalSize:function(){return this.fields.totalSize},getTrackers:function(){return this.fields.trackers},getUploadSpeed:function(){return this.fields.rateUpload},getUploadRatio:function(){return this.fields.uploadRatio},getUploadedEver:function(){return this.fields.uploadedEver},getWebseedsSendingToUs:function(){return this.fields.webseedsSendingToUs},isFinished:function(){return this.fields.isFinished},hasExtraInfo:function(){return"hashString"in this.fields},isSeeding:function(){return this.getStatus()===Torrent._StatusSeed},isStopped:function(){return this.getStatus()===Torrent._StatusStopped},isChecking:function(){return this.getStatus()===Torrent._StatusCheck},isDownloading:function(){return this.getStatus()===Torrent._StatusDownload},isDone:function(){return this.getLeftUntilDone()<1},needsMetaData:function(){return this.getMetadataPercentComplete()<1},getActivity:function(){return this.getDownloadSpeed()+this.getUploadSpeed()},getPercentDoneStr:function(){return Transmission.fmt.percentString(100*this.getPercentDone())},getPercentDone:function(){return this.fields.percentDone},getStateString:function(){switch(this.getStatus()){case Torrent._StatusStopped:return this.isFinished()?"完成做种":"暂停";case Torrent._StatusCheckWait:return"排队等待验证";case Torrent._StatusCheck:return"正在验证本地数据";case Torrent._StatusDownloadWait:return"排队等待下载";case Torrent._StatusDownload:return"下载中";case Torrent._StatusSeedWait:return"排队等待做种";case Torrent._StatusSeed:return"做种中";case null:case void 0:return"未知";default:return"错误"}},seedRatioLimit:function(e){switch(this.getSeedRatioMode()){case Torrent._RatioUseGlobal:return e.seedRatioLimit();case Torrent._RatioUseLocal:return this.getSeedRatioLimit();default:return-1}},getErrorMessage:function(){var e=parseStr(this.getErrorString());switch(this.getError()){case Torrent._ErrTrackerWarning:return"Tracker 返回了一个警告: "+e;case Torrent._ErrTrackerError:return"Tracker 返回了一个错误: "+e;case Torrent._ErrLocalError:return"错误: "+e;default:return null}},getCollatedName:function(){var e=this.fields;return!e.collatedName&&e.name&&(e.collatedName=e.name.toLowerCase()),e.collatedName||""},getCollatedTrackers:function(){var e=this.fields;return!e.collatedTrackers&&e.trackers&&(e.collatedTrackers=this.collateTrackers(e.trackers)),e.collatedTrackers||""},testState:function(e){var t=this.getStatus();switch(e){case Prefs._FilterActive:return this.getPeersGettingFromUs()>0||this.getPeersSendingToUs()>0||this.getWebseedsSendingToUs()>0||this.isChecking();case Prefs._FilterSeeding:return t===Torrent._StatusSeed||t===Torrent._StatusSeedWait;case Prefs._FilterDownloading:return t===Torrent._StatusDownload||t===Torrent._StatusDownloadWait;case Prefs._FilterPaused:return this.isStopped();case Prefs._FilterFinished:return this.isFinished();default:return!0}},test:function(e,t,r){var n=this.testState(e);return n&&t&&t.length&&(n=this.getCollatedName().indexOf(t.toLowerCase())!==-1),n&&r&&r.length&&(n=this.getCollatedTrackers().indexOf(r)!==-1),n}},Torrent.compareById=function(e,t){return e.getId()-t.getId()},Torrent.compareByName=function(e,t){return e.getCollatedName().localeCompare(t.getCollatedName())||Torrent.compareById(e,t)},Torrent.compareByQueue=function(e,t){return e.getQueuePosition()-t.getQueuePosition()},Torrent.compareByAge=function(e,t){var r=e.getDateAdded(),n=t.getDateAdded();return n-r||Torrent.compareByQueue(e,t)},Torrent.compareByState=function(e,t){var r=e.getStatus(),n=t.getStatus();return n-r||Torrent.compareByQueue(e,t)},Torrent.compareByActivity=function(e,t){var r=e.getActivity(),n=t.getActivity();return n-r||Torrent.compareByState(e,t)},Torrent.compareByRatio=function(e,t){var r=e.getUploadRatio(),n=t.getUploadRatio();return r<n?1:r>n?-1:Torrent.compareByState(e,t)},Torrent.compareByProgress=function(e,t){var r=e.getPercentDone(),n=t.getPercentDone();return r-n||Torrent.compareByRatio(e,t)},Torrent.compareBySize=function(e,t){var r=e.getTotalSize(),n=t.getTotalSize();return r-n||Torrent.compareByName(e,t)},Torrent.compareTorrents=function(e,t,r,n){var i;switch(r){case Prefs._SortByActivity:i=Torrent.compareByActivity(e,t);break;case Prefs._SortByAge:i=Torrent.compareByAge(e,t);break;case Prefs._SortByQueue:i=Torrent.compareByQueue(e,t);break;case Prefs._SortByProgress:i=Torrent.compareByProgress(e,t);break;case Prefs._SortBySize:i=Torrent.compareBySize(e,t);break;case Prefs._SortByState:i=Torrent.compareByState(e,t);break;case Prefs._SortByRatio:i=Torrent.compareByRatio(e,t);break;default:i=Torrent.compareByName(e,t)}return n===Prefs._SortDescending&&(i=-i),i},Torrent.sortTorrents=function(e,t,r){switch(t){case Prefs._SortByActivity:e.sort(this.compareByActivity);break;case Prefs._SortByAge:e.sort(this.compareByAge);break;case Prefs._SortByQueue:e.sort(this.compareByQueue);break;case Prefs._SortByProgress:e.sort(this.compareByProgress);break;case Prefs._SortBySize:e.sort(this.compareBySize);break;case Prefs._SortByState:e.sort(this.compareByState);break;case Prefs._SortByRatio:e.sort(this.compareByRatio);break;default:e.sort(this.compareByName)}return r===Prefs._SortDescending&&e.reverse(),e};